var F=h=>{throw TypeError(h)};var j=(h,t,e)=>t.has(h)||F("Cannot "+e);var i=(h,t,e)=>(j(h,t,"read from private field"),e?e.call(h):t.get(h)),p=(h,t,e)=>t.has(h)?F("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(h):t.set(h,e),n=(h,t,e,r)=>(j(h,t,"write to private field"),r?r.call(h,e):t.set(h,e),e),o=(h,t,e)=>(j(h,t,"access private method"),e);import{g as q}from"./vidstack-MB353KSX-UhkXIQzB.js";import{resolveYouTubeVideoId as z}from"./vidstack-VCI6V3YB-BlSMBUtA.js";import{y as A,R as G,g as H,F as J,L as K,W as N,m as Q,l as X,j as P,h as C,n as Z}from"./app-CzfmgGZt.js";var f={Unstarted:-1,Ended:0,Playing:1,Paused:2,Buffering:3,Cued:5},a,v,b,w,k,c,y,s,E,O,I,m,U,Y,B,M,S,x,W,_,$,L,at=(L=class extends q{constructor(t,e){super(t);p(this,s);p(this,a);p(this,v);p(this,b);p(this,w);p(this,k);p(this,c);p(this,y);this.$$PROVIDER_TYPE="YOUTUBE",this.scope=A(),n(this,v,G("")),n(this,b,-1),n(this,w,null),n(this,k,-1),n(this,c,!1),n(this,y,new Map),this.language="en",this.color="red",this.cookies=!1,n(this,a,e)}get currentSrc(){return i(this,w)}get type(){return"youtube"}get videoId(){return i(this,v).call(this)}preconnect(){H(this.getOrigin())}setup(){super.setup(),J(o(this,s,I).bind(this)),i(this,a).notify("provider-setup",this)}destroy(){o(this,s,_).call(this);let t="provider destroyed";for(let e of i(this,y).values())for(let{reject:r}of e)r(t);i(this,y).clear()}async play(){return o(this,s,m).call(this,"playVideo")}async pause(){return o(this,s,m).call(this,"pauseVideo")}setMuted(t){t?o(this,s,m).call(this,"mute"):o(this,s,m).call(this,"unMute")}setCurrentTime(t){n(this,c,i(this,a).$state.paused()),o(this,s,m).call(this,"seekTo",t),i(this,a).notify("seeking",t)}setVolume(t){o(this,s,m).call(this,"setVolume",t*100)}setPlaybackRate(t){o(this,s,m).call(this,"setPlaybackRate",t)}async loadSource(t){if(!K(t.src)){n(this,w,null),i(this,v).set("");return}let e=z(t.src);i(this,v).set(e??""),n(this,w,t)}getOrigin(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}buildParams(){let{keyDisabled:t}=i(this,a).$props,{muted:e,playsInline:r,nativeControls:d}=i(this,a).$state,l=d();return{autoplay:0,cc_lang_pref:this.language,cc_load_policy:l?1:void 0,color:this.color,controls:l?1:0,disablekb:!l||t()?1:0,enablejsapi:1,fs:1,hl:this.language,iv_load_policy:l?1:3,mute:e()?1:0,playsinline:r()?1:0}}onLoad(){window.setTimeout(()=>this.postMessage({event:"listening"}),100)}onMessage({info:t},e){var u;if(!t)return;let{title:r,intrinsicDuration:d,playbackRate:l}=i(this,a).$state;if(X(t.videoData)&&t.videoData.title!==r()&&i(this,a).notify("title-change",t.videoData.title,e),P(t.duration)&&t.duration!==d()){if(P(t.videoLoadedFraction)){let g=((u=t.progressState)==null?void 0:u.loaded)??t.videoLoadedFraction*t.duration,T=new C(0,t.duration);o(this,s,M).call(this,g,T,e)}i(this,a).notify("duration-change",t.duration,e)}if(P(t.playbackRate)&&t.playbackRate!==l()&&i(this,a).notify("rate-change",t.playbackRate,e),t.progressState){let{current:g,seekableStart:T,seekableEnd:V,loaded:R,duration:D}=t.progressState;o(this,s,B).call(this,g,e),o(this,s,M).call(this,R,new C(T,V),e),D!==d()&&i(this,a).notify("duration-change",D,e)}if(P(t.volume)&&Z(t.muted)){let g={muted:t.muted,volume:t.volume/100};i(this,a).notify("volume-change",g,e)}P(t.playerState)&&t.playerState!==i(this,b)&&o(this,s,W).call(this,t.playerState,e)}},a=new WeakMap,v=new WeakMap,b=new WeakMap,w=new WeakMap,k=new WeakMap,c=new WeakMap,y=new WeakMap,s=new WeakSet,E=function(t){var e;(e=o(this,s,$).call(this,"playVideo"))==null||e.reject(t)},O=function(t){var e;(e=o(this,s,$).call(this,"pauseVideo"))==null||e.reject(t)},I=function(){o(this,s,_).call(this);let t=i(this,v).call(this);if(!t){this.src.set("");return}this.src.set(`${this.getOrigin()}/embed/${t}`),i(this,a).notify("load-start")},m=function(t,e){let r=N(),d=i(this,y).get(t);return d||i(this,y).set(t,d=[]),d.push(r),this.postMessage({event:"command",func:t,args:e?[e]:void 0}),r.promise},U=function(t){i(this,a).notify("loaded-metadata"),i(this,a).notify("loaded-data"),i(this,a).delegate.ready(void 0,t)},Y=function(t){var e;(e=o(this,s,$).call(this,"pauseVideo"))==null||e.resolve(),i(this,a).notify("pause",void 0,t)},B=function(t,e){let{duration:r,realCurrentTime:d}=i(this,a).$state,l=i(this,b)===f.Ended,u=l?r():t;i(this,a).notify("time-change",u,e),!l&&Math.abs(u-d())>1&&i(this,a).notify("seeking",u,e)},M=function(t,e,r){let d={buffered:new C(0,t),seekable:e};i(this,a).notify("progress",d,r);let{seeking:l,realCurrentTime:u}=i(this,a).$state;l()&&t>u()&&o(this,s,S).call(this,r)},S=function(t){let{paused:e,realCurrentTime:r}=i(this,a).$state;window.clearTimeout(i(this,k)),n(this,k,window.setTimeout(()=>{i(this,a).notify("seeked",r(),t),n(this,k,-1)},e()?100:0)),n(this,c,!1)},x=function(t){let{seeking:e}=i(this,a).$state;e()&&o(this,s,S).call(this,t),i(this,a).notify("pause",void 0,t),i(this,a).notify("end",void 0,t)},W=function(t,e){var R;let{started:r,paused:d,seeking:l}=i(this,a).$state,u=t===f.Playing,g=t===f.Buffering,T=!Q(o(this,s,$).call(this,"playVideo")),V=(d()||T)&&(g||u);if(g&&i(this,a).notify("waiting",void 0,e),l()&&u&&o(this,s,S).call(this,e),!r()&&V&&i(this,c)){o(this,s,E).call(this,"invalid internal play operation"),u&&(this.pause(),n(this,c,!1));return}switch(V&&((R=o(this,s,$).call(this,"playVideo"))==null||R.resolve(),i(this,a).notify("play",void 0,e)),t){case f.Unstarted:o(this,s,E).call(this,"provider rejected"),o(this,s,O).call(this,"provider rejected"),i(this,a).notify("pause",void 0,e);break;case f.Cued:o(this,s,U).call(this,e);break;case f.Playing:i(this,a).notify("playing",void 0,e);break;case f.Paused:o(this,s,Y).call(this,e);break;case f.Ended:o(this,s,x).call(this,e);break}n(this,b,t)},_=function(){n(this,b,-1),n(this,k,-1),n(this,c,!1)},$=function(t){var e;return(e=i(this,y).get(t))==null?void 0:e.shift()},L);export{at as YouTubeProvider};
