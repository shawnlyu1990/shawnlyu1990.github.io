import{w as s,z as i,C as a,K as n}from"./app-0ycfrgdF.js";const l="/assets/postsimages/2021-03-22-CentOS7%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1-OpenLDAP/01-%E7%99%BB%E5%BD%95phpldapadmin-1.png",e="/assets/postsimages/2021-03-22-CentOS7%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1-OpenLDAP/02-%E7%99%BB%E5%BD%95phpldapadmin-2.png",t={},h=n(`<div class="hint-container important"><p class="hint-container-title">重要</p><p>由于作者水平有限，以下内容仅在我的环境中配置成功，这里提供思路供您参考。</p><p>因为每个环境各有差异，如果有些配置在您的环境中出现了一些异常错误，请您自行排查解决。</p></div><h2 id="_1-背景" tabindex="-1"><a class="header-anchor" href="#_1-背景"><span>1. 背景</span></a></h2><p>OpenLDAP 是开源的目录服务实现，AD 是微软的目录服务实现。在我们的业务环境中可能会出现有的应用场景（应用、客户端）跟 OpenLDAP 结合比较容易；有的应用场景又必须要使用 AD。几乎不可能弃用其中的任意一种。但同时维护两套系统意味着维护工作大量增加（不仅仅只是增加一倍，要考虑信息分别维护、同步等）、出错几率大大增加。</p><p>其中的一种较成熟、使用比较多的解决方案是：OpenLDAP 使用 AD 的认证，即只在 AD 上维护一套用户密码，OpenLDAP 将认证转发到微软 AD 上进行。</p><h2 id="_2-相关组件" tabindex="-1"><a class="header-anchor" href="#_2-相关组件"><span>2. 相关组件</span></a></h2><ol><li><strong>LDAP Client</strong>：这个是实际调用 ldap 服务的系统，也可以是类似 ldapsearch 之类的 client 程序</li><li><strong>OpenLDAP 服务器</strong>：开源服务端，实际进程为 slapd</li><li><strong>saslauthd</strong>：简单认证服务层的守护进程，该进程要安装在 openldap 服务器上</li><li><strong>AD</strong>：微软AD</li></ol><h2 id="_3-部署" tabindex="-1"><a class="header-anchor" href="#_3-部署"><span>3. 部署</span></a></h2><h3 id="_3-1-安装-openldap" tabindex="-1"><a class="header-anchor" href="#_3-1-安装-openldap"><span>3.1. 安装 OpenLdap</span></a></h3><h4 id="_3-1-1-安装-openldap-服务" tabindex="-1"><a class="header-anchor" href="#_3-1-1-安装-openldap-服务"><span>3.1.1. 安装 OpenLDAP 服务</span></a></h4><div class="hint-container warning"><p class="hint-container-title">注意</p><p>本文仅以 OpenLDAP 2.4.44 版本为例进行安装和配置说明，其他版本如有差异请以实际为准。</p></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# yum install -y openldap openldap-clients openldap-servers-sql compat-openldap openldap-devel openldap-servers</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# systemctl restart slapd.service</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# systemctl enable slapd.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-2-配置-openldap-管理密码-并修改-openldap-配置" tabindex="-1"><a class="header-anchor" href="#_3-1-2-配置-openldap-管理密码-并修改-openldap-配置"><span>3.1.2. 配置 OpenLDAP 管理密码，并修改 OpenLDAP 配置</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# slappasswd</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">New</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> password:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Re-enter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> new</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> password:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{SSHA}zBfhcYEI5u6mUJUAk6f46rSxLPksOLQo</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>把上面生成的 {SSHA} 开头的字符串记下来，后面修改配置文件要用</p></div><p>创建一个 ldif 文件用于修改 OpenLDAP 配置，旧版本的 OpenLDAP 修改配置是可以直接修改 slapd.conf 文件的，但是新版本的 OpenLDAP 的配置文件全部在 <code>/etc/openldap/slapd.d/</code> 目录下，不能随意使用 <code>vim</code> 修改，如果手动使用 <code>vim</code> 方式修改了配置文件，则会导致配置文件校验和不一致，可能会出现一些未知的问题。</p><p>新建一个 <code>change_ldap_cfg.ldif</code> 文件用于修改 OpenLDAP 配置，将以下内容写入</p><div class="language-ssh-config line-numbers-mode" data-highlighter="shiki" data-ext="ssh-config" data-title="change_ldap_cfg.ldif" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 实际配置的时候建议把 “#” 后面的注释内容删掉，只保留配置内容</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">dn: olcDatabase={</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}hdb,cn=config  </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 表示修改 /etc/openldap/slapd.d/cn=config/olcDatabase={2}hdb.ldif 这个文件里的内容</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">changetype: modify  </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 表示我们需要为这个文件执行变更操作</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">replace: olcRootDN  </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 修改 olcRootDN 这个字段的内容</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">olcRootDN: cn=Manager,dc=test,dc=winad,dc=com  </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 把 olcRootDN 这个字段的内容修改成这样</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-  </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 具体含义不知道，但是大概表示上面这个 dn 的配置还没修改完，下面还是修改这个 dn 的配置</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">replace: olcSuffix  </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 修改 olcSuffix 这个字段的内容</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">olcSuffix: dc=test,dc=winad,dc=com  </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 把 olcSuffix 这个字段的内容修改成这样</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">add: olcRootPW   </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 增加一个 olcRootPW 字段</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">olcRootPW: {</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">SSHA</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}NKL0WdsiEPUSnjpCrz+ZbwJTuTK1inZh   </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 增加的 olcRootPW 这个字段的内容是这样</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">dn: olcDatabase={</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}monitor,cn=config  </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 表示修改 /etc/openldap/slapd.d/cn=config/olcDatabase={1}monitor.ldif 这个文件里的内容</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">changetype: modify  </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 表示我们需要为这个文件执行变更操作</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">replace: olcAccess  </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 修改 olcAccess 这个字段的内容</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">olcAccess: {</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}to * by dn.base=&quot;gidNumber=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">+uidNumber=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,cn=peercred,cn=extern</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> al,cn=auth&quot; read by dn.base=&quot;cn=Manager,dc=test,dc=winad,dc=com&quot; read by * none  </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 把 olcAccess 这个字段的内容修改成这样</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的配置文件保存好之后，执行 <code>ldapmodify</code> 命令进行修改</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapmodify -Y EXTERNAL -H ldapi:/// -f change_ldap_cfg.ldif </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SASL/EXTERNAL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> authentication</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> started</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SASL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> username:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SASL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SSF:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">modifying</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> entry</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;olcDatabase={2}hdb,cn=config&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">modifying</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> entry</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;olcDatabase={1}monitor,cn=config&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行完了以后看下下面这两个文件，看看需要修改的字段改过来没有</p><p><code>/etc/openldap/slapd.d/cn=config/olcDatabase={1}monitor.ldif</code><br><code>/etc/openldap/slapd.d/cn=config/olcDatabase={2}hdb.ldif</code></p><h4 id="_3-1-3-创建管理员账号" tabindex="-1"><a class="header-anchor" href="#_3-1-3-创建管理员账号"><span>3.1.3. 创建管理员账号</span></a></h4><p>新建一个 <code>base.ldif</code> 文件用于导入管理员账号，在文件中添加如下内容</p><div class="language-ssh-config line-numbers-mode" data-highlighter="shiki" data-ext="ssh-config" data-title="base.ldif" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">dn: dc=test,dc=winad,dc=com</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">o: test winad com</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">dc: test</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: top</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: dcObject</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectclass: organization</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">dn: cn=Manager,dc=test,dc=winad,dc=com</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">cn: Manager</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: organizationalRole</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">description: Directory Manager</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的配置文件保存好之后，执行 <code>ldapadd</code> 命令导入</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 导入账号</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -x -D </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;cn=Manager,dc=test,dc=winad,dc=com&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -W -f base.ldif </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Enter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> LDAP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Password:</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  # 这里输的密码就是上面第二步的时候配置的那个密码</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">adding</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> new</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> entry</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;dc=test,dc=winad,dc=com&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">adding</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> new</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> entry</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;cn=Manager,dc=test,dc=winad,dc=com&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-4-配置-db-数据库" tabindex="-1"><a class="header-anchor" href="#_3-1-4-配置-db-数据库"><span>3.1.4. 配置 DB 数据库</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# chown ldap:ldap -R /var/lib/ldap</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# chmod 700 -R /var/lib/ldap</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-5-验证-openldap-配置文件是否正确" tabindex="-1"><a class="header-anchor" href="#_3-1-5-验证-openldap-配置文件是否正确"><span>3.1.5. 验证 OpenLDAP 配置文件是否正确</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# slaptest -u</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">config</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> testing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> succeeded</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">   #验证成功，如果是返回其他内容则失败。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-6-给相关目录授权-否则启动服务时可能会报错-权限不足" tabindex="-1"><a class="header-anchor" href="#_3-1-6-给相关目录授权-否则启动服务时可能会报错-权限不足"><span>3.1.6. 给相关目录授权，否则启动服务时可能会报错，权限不足</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# chown ldap:ldap -R /var/run/openldap</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# chown ldap:ldap -R /etc/openldap/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-7-导入-schema" tabindex="-1"><a class="header-anchor" href="#_3-1-7-导入-schema"><span>3.1.7. 导入 schema</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/collective.ldif</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/corba.ldif</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/core.ldif</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/duaconf.ldif</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/dyngroup.ldif</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/java.ldif</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/misc.ldif</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/openldap.ldif</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/pmi.ldif</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/ppolicy.ldif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-8-添加-memberof-模块" tabindex="-1"><a class="header-anchor" href="#_3-1-8-添加-memberof-模块"><span>3.1.8. 添加 memberOf 模块</span></a></h4><p>因为我们是要和 Windows AD 联动，所以需要将权限组这个模块提前准备好。如果提前没有准备好，后面再加的话，还得把建好的组全删掉再重建。这个模块的作用是当你建一个组的时候，把一些用户添加到这个组里去，它会自动给这些用户添加一个 memberOf 属性，有很多应用需要检查这个属性。</p><p>添加的时候比较麻烦，需要建 3 个 ldif 文件，然后 1 个执行 <code>ldapmodify</code>，2 个执行 <code>ldapadd</code>，注意顺序，不能出错</p><p>新建一个 <code>memberof_config.ldif</code> 文件，在文件中写入以下内容</p><div class="language-ssh-config line-numbers-mode" data-highlighter="shiki" data-ext="ssh-config" data-title="memberof_config.ldif" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">dn: cn=module,cn=config</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">cn: module</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: olcModuleList</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">olcModuleLoad: memberof</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">olcModulePath: /usr/lib64/openldap </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 这里请注意，请确认 /usr/lib64/ 目录下是否有 openldap 目录</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">dn: olcOverlay={</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}memberof,olcDatabase={</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}hdb,cn=config  </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 这个意思是说在 /etc/openldap/slapd.d/cn=config/ 目录下创建一个 olcDatabase={2}hdb 目录，然后在里面再创建一个 olcOverlay={0}memberof.ldif 文件</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: olcConfig</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: olcMemberOf</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: olcOverlayConfig</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: top</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">olcOverlay: memberof</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">olcMemberOfDangling: ignore</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">olcMemberOfRefInt: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">TRUE</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">olcMemberOfGroupOC: groupOfNames</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">olcMemberOfMemberAD: member</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">olcMemberOfMemberOfAD: memberOf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>文件保存好之后，执行 <code>ldapadd</code> 命令</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f memberof_config.ldif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>执行完之后，检查你的 <code>/etc/openldap/slapd.d/cn=config/olcDatabase={2}hdb/</code> 目录下，看是不是多了一个 <code>olcOverlay={0}memberof.ldif</code> 模块</p><p>然后检查你的 <code>/etc/openldap/slapd.d/cn=config/</code> 目录下，看是不是多了一个 <code>cn=module{0}.ldif</code> 模块，这个模块的数字编号直接影响下一步操作。</p><p>新建一个 <code>refint1.ldif</code> 文件，在文件中写入以下内容</p><div class="language-ssh-config line-numbers-mode" data-highlighter="shiki" data-ext="ssh-config" data-title="refint1.ldif" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line highlighted"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">dn: cn=module{</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">},cn=config </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 这里的意思就是我们上面说的那个 /etc/openldap/slapd.d/cn=config/ 目录下的 cn=module{0}.ldif，我们这一次要修改这个文件</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">add: olcmoduleload</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">olcmoduleload: refint</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你那边不是 <code>module{0}</code> 的话，那就看是几，是几就写几就行了，对于这个文件，我们要执行 <code>ldapmodify</code> 操作：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapmodify -Y EXTERNAL -H ldapi:/// -f refint1.ldif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>接下来新建一个 <code>refint2.ldif</code> 文件，在文件中写入以下内容</p><div class="language-ssh-config line-numbers-mode" data-highlighter="shiki" data-ext="ssh-config" data-title="refint2.ldif" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">dn: olcOverlay={</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}refint,olcDatabase={</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}hdb,cn=config </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 在 /etc/openldap/slapd.d/cn=config/olcDatabase={2}hdb 目录下，再创建一个 olcOverlay={1}refint.ldif 文件</span></span>
<span class="line highlighted"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: olcConfig</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: olcOverlayConfig</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: olcRefintConfig</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: top</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">olcOverlay: {</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}refint</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">olcRefintAttribute: memberof member manager owner</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对这个文件执行 <code>ldapadd</code> 操作：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f refint2.ldif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>重启<code>slapd</code>服务</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# systemctl restart slapd.service </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# systemctl status slapd.service </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">●</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slapd.service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OpenLDAP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Daemon</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   Loaded:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> loaded</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (/usr/lib/systemd/system/slapd.service; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">vendor</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> preset:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> disabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   Active:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> active</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (running) since Wed 2021-03-17 18:11:37 CST; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ago</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     Docs:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> man:slapd</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">           man:slapd-config</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">           man:slapd-hdb</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">           man:slapd-mdb</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">           file:///usr/share/doc/openldap-servers/guide.html</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Process:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1144</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ExecStart=/usr/sbin/slapd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldap</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">SLAPD_URLS</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $SLAPD_OPTIONS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (code=exited, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">status=0/SUCCESS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Process:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1113</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ExecStartPre=/usr/libexec/openldap/check-config.sh</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (code=exited, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">status=0/SUCCESS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Main</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PID:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1147</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (slapd)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   CGroup:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /system.slice/slapd.service</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">           └─1147</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/sbin/slapd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldap</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapi:///</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldap:///</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Mar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 17</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 18:11:36</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost.localdomain</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> runuser[1137]:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pam_unix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">runuser:session</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ses...p</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Mar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 17</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 18:11:36</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost.localdomain</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> runuser[1139]:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pam_unix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">runuser:session</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ses...</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Mar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 17</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 18:11:36</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost.localdomain</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> runuser[1139]:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pam_unix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">runuser:session</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ses...p</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Mar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 17</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 18:11:36</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost.localdomain</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> runuser[1141]:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pam_unix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">runuser:session</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ses...</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Mar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 17</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 18:11:36</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost.localdomain</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> runuser[1141]:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pam_unix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">runuser:session</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ses...p</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Mar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 17</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 18:11:36</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost.localdomain</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slapd[1144]:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> @</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(#) $OpenLDAP: slapd 2.4.44 (Se...$</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                                           mockbuild@x86-02.bsys.ce...d</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Mar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 17</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 18:11:36</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost.localdomain</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slapd[1144]:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldif_read_file:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> checksum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> error</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> o...&quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Mar 17 18:11:36 localhost.localdomain slapd[1144]: ldif_read_file: checksum error o...&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Mar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 17</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 18:11:37</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost.localdomain</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slapd[1147]:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slapd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> starting</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Mar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 17</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 18:11:37</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost.localdomain</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemd[1]:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Started</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OpenLDAP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Daemon.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Hint:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Some</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lines</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> were</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ellipsized,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> use</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> show</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> full.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-9-检查-openldap-状态" tabindex="-1"><a class="header-anchor" href="#_3-1-9-检查-openldap-状态"><span>3.1.9. 检查 OpenLDAP 状态</span></a></h4><p>执行 <code>ldapsearch -x</code> 检查是否有如下输出</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapsearch -x -b </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -s base</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;(objectclass=*)&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># extended LDIF</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># LDAPv3</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># base &lt;&gt; with scope baseObject</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># filter: (objectclass=*)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># requesting: ALL</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dn:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">objectClass:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> top</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">objectClass:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OpenLDAProotDSE</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># search result</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">search:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">result:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Success</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># numResponses: 2</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># numEntries: 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-部署-saslauthd" tabindex="-1"><a class="header-anchor" href="#_3-2-部署-saslauthd"><span>3.2. 部署 Saslauthd</span></a></h3><h4 id="_3-2-1-安装-saslauthd-服务" tabindex="-1"><a class="header-anchor" href="#_3-2-1-安装-saslauthd-服务"><span>3.2.1. 安装 saslauthd 服务</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# yum install -y cyrus-sasl</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# systemctl restart saslauthd.service</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# systemctl enable saslauthd.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-2-测试一下-ldapsearch-搜索-windows-ad-是否正常" tabindex="-1"><a class="header-anchor" href="#_3-2-2-测试一下-ldapsearch-搜索-windows-ad-是否正常"><span>3.2.2. 测试一下 ldapsearch 搜索 Windows AD 是否正常</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# /usr/bin/ldapsearch -x -H ldap://test.winad.com </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;(&amp;(objectClass=organizationalPerson)(!(objectClass=computer)))&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> dn objectClass cn description sAMAccountName email uSNCreated -D </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;CN=Administrator,CN=Users,DC=test,DC=winad,DC=com&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -w </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;testtest&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -b </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;OU=Test Users,DC=test,DC=winad,DC=com&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -L</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果能搜索到用户，说明 OpenLDAP 访问 Windows AD 正常</p><h4 id="_3-2-3-配置-sasl-访问-ad" tabindex="-1"><a class="header-anchor" href="#_3-2-3-配置-sasl-访问-ad"><span>3.2.3. 配置 sasl 访问 AD</span></a></h4><p>编辑 <code>/etc/sysconfig/saslauthd</code>，修改下面两行</p><div class="language-ssh-config line-numbers-mode" data-highlighter="shiki" data-ext="ssh-config" data-title="/etc/sysconfig/saslauthd" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">MECH</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=ldap</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">FLAGS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=&quot;-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">O</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /etc/saslauthd2ad.conf&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后新建一个 <code>/etc/saslauthd2ad.conf</code>，写入下面内容</p><div class="language-ssh-config line-numbers-mode" data-highlighter="shiki" data-ext="ssh-config" data-title="/etc/saslauthd2ad.conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ldap_servers: ldap:</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">//test.winad.com</span></span>
<span class="line highlighted"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ldap_search_base: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">DC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=test,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">DC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=winad,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">DC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=com</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ldap_timeout: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">60</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ldap_filter: sAMAccountName=%</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">U</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ldap_bind_dn: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">CN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=Administrator,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">CN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=Users,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">DC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=test,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">DC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=winad,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">DC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=com</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ldap_password: testAD</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ldap_deref: never</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ldap_restart: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">yes</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ldap_scope: sub</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ldap_use_sasl: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">no</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ldap_start_tls: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">no</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ldap_version: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ldap_auth_method: bind</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启 <code>saslauthd</code> 服务</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# systemctl restart saslauthd.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>使用 <code>testsaslauthd</code> 命令测试 Windows AD 上的用户是否认证成功</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# testsaslauthd -u Administrator -p testAD</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OK</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Success.&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>可进一步在 AD 里面加用户、或改密码测试。</p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>需注意 AD 修改密码，老密码依然可用5分钟。如验证不通过检查 sasl 的配置。</p></div><h4 id="_3-2-4-配置-openldap-使用-saslauthd" tabindex="-1"><a class="header-anchor" href="#_3-2-4-配置-openldap-使用-saslauthd"><span>3.2.4. 配置 OpenLDAP 使用 Saslauthd</span></a></h4><p>编辑<code>/etc/openldap/ldap.conf</code>，增加以下内容</p><div class="language-ssh-config line-numbers-mode" data-highlighter="shiki" data-ext="ssh-config" data-title="/etc/openldap/ldap.conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">TLS_REQCERT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> never</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>编辑<code>/etc/sasl2/slapd.conf</code>，增加以下内容</p><div class="language-ssh-config line-numbers-mode" data-highlighter="shiki" data-ext="ssh-config" data-title="/etc/sasl2/slapd.conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">mech_list: plain</span></span>
<span class="line highlighted"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">pwcheck_method: saslauthd</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">saslauthd_path: /var/run/saslauthd/mux</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启 <code>saslauthd</code> 服务</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# systemctl restart saslauthd.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>验证 OpenLDAP 是否支持 SASL</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapsearch -x -H ldap://127.0.0.1 -ZZ -b </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -LLL -s base supportedSASLMechanisms</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dn:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">supportedSASLMechanisms:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> LOGIN</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">supportedSASLMechanisms:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PLAIN</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>出现如上结果说明openldap已支持SASL认证</p></div><h3 id="_3-3-安装-phpldapadmin" tabindex="-1"><a class="header-anchor" href="#_3-3-安装-phpldapadmin"><span>3.3. 安装 phpldapadmin</span></a></h3><p>phpldapadmin 提供了使用 Web 页面管理 OpenLDAP 的方式</p><h4 id="_3-3-1-安装-php-基础包和-phpldapadmin" tabindex="-1"><a class="header-anchor" href="#_3-3-1-安装-php-基础包和-phpldapadmin"><span>3.3.1. 安装 php 基础包和 phpldapadmin</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# yum -y install httpd php php-ldap php-gd php-mbstring php-pear php-bcmath php-xml</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# yum install -y epel-release</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# yum install -y phpldapadmin</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-2-配置-phpldapadmin" tabindex="-1"><a class="header-anchor" href="#_3-3-2-配置-phpldapadmin"><span>3.3.2. 配置 phpldapadmin</span></a></h4><p>编辑 <code>/etc/httpd/conf.d/phpldapadmin.conf</code>，添加以下内容</p><div class="language-ssh-config line-numbers-mode" data-highlighter="shiki" data-ext="ssh-config" data-title="/etc/httpd/conf.d/phpldapadmin.conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#  Web-based tool for managing LDAP servers</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Alias /phpldapadmin /usr/share/phpldapadmin/htdocs</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Alias /ldapadmin /usr/share/phpldapadmin/htdocs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;Directory /usr/share/phpldapadmin/htdocs&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;IfModule mod_authz_core.c&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    # Apache 2.4</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    Require local</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    Require all granted </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 新增此行</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;/IfModule&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;IfModule !mod_authz_core.c&gt; </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 如果你的php是2.2版本才需要关注这里，否则不用关注。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    # Apache 2.2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    Order Deny,Allow</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    Deny from all</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    Allow from </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">127.0.0.1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    Allow from ::</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;/IfModule&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/Directory&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-3-修改-phpldapadmin-配置文件" tabindex="-1"><a class="header-anchor" href="#_3-3-3-修改-phpldapadmin-配置文件"><span>3.3.3. 修改 phpldapadmin 配置文件</span></a></h4><p>编辑 <code>/etc/phpldapadmin/config.php</code>.</p><div class="language-php line-numbers-mode" data-highlighter="shiki" data-ext="php" data-title="/etc/phpldapadmin/config.php" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 将      $servers-&gt;setValue(&#39;login&#39;,&#39;attr&#39;,&#39;uid&#39;);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 修改为   $servers-&gt;setValue(&#39;login&#39;,&#39;attr&#39;,&#39;dn&#39;);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$servers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;login&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;attr&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;dn&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-4-启动-httpd-服务" tabindex="-1"><a class="header-anchor" href="#_3-3-4-启动-httpd-服务"><span>3.3.4. 启动 httpd 服务</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# systemctl start httpd</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# systemctl enable httpd</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# systemctl status httpd</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-5-登录验证" tabindex="-1"><a class="header-anchor" href="#_3-3-5-登录验证"><span>3.3.5. 登录验证</span></a></h4><p>使用浏览器登录 phpldapadmin</p><p><code>http://{LDAP Server IP}/phpldapadmin</code></p><p>使用管理员DN <code>cn=Manager,dc=test,dc=winad,dc=com</code> 和 <a href="#312-%E9%85%8D%E7%BD%AE-openldap-%E7%AE%A1%E7%90%86%E5%AF%86%E7%A0%81%E5%B9%B6%E4%BF%AE%E6%94%B9-openldap-%E9%85%8D%E7%BD%AE">3.1.2 步骤</a>配置的管理员密码登录</p><figure><img src="`+l+'" alt="登录 phpldapadmin" tabindex="0" loading="lazy"><figcaption>登录 phpldapadmin</figcaption></figure><figure><img src="'+e+`" alt="在这里插入图片描述" tabindex="0" loading="lazy"><figcaption>在这里插入图片描述</figcaption></figure><h3 id="_3-4-测试-openldap-使用-ad-密码进行认证" tabindex="-1"><a class="header-anchor" href="#_3-4-测试-openldap-使用-ad-密码进行认证"><span>3.4. 测试 OpenLDAP 使用 AD 密码进行认证</span></a></h3><p>创建一个测试用户导入文件 <code>testuser.ldif</code>，写入以下内容</p><div class="language-ssh-config line-numbers-mode" data-highlighter="shiki" data-ext="ssh-config" data-title="testuser.ldif" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">dn: cn=testuset,dc=test,dc=winad,dc=com</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: top</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: person</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: organizationalPerson</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">objectClass: inetOrgPerson</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">cn:: testuser</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">sn:: testuser</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">description: testuser</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">uid: testuser</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">userPassword: {</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">SASL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}testuser</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>导入测试用户</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapadd -x -D </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;cn=Manager,dc=test,dc=winad,dc=com&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -W -f testuser.ldif</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Enter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> LDAP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Password:</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # 输入管理员密码</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">adding</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> new</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> entry</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;cn=testuser,dc=test,dc=winad,dc=com&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用命令测试</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@localhost ~]# ldapsearch -w testuser -H ldap://10.206.153.222 -D </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;cn=testuser,dc=test,dc=winad,dc=com&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -b </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;dc=test,dc=winad,dc=com&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这个测试命令，<code>testuser</code> 用户在 OpenLDAP 和 Windows AD 上都存在，IP 是本机 OpenLDAP 的 IP，DN，查询 DN 也都是OpenLDAP的信息，但是密码却是在 Windows AD 上管理的。如成功，到 Windows AD 上修改用户密码，用新密码验证，再等 5 分钟，旧密码失效。到此配置完成</p><h2 id="_4-参考" tabindex="-1"><a class="header-anchor" href="#_4-参考"><span>4. 参考</span></a></h2><ol><li>《OpenLDAP配置坎坷路》 <a href="https://www.cnblogs.com/linkenpark/p/10807735.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/linkenpark/p/10807735.html</a></li><li>《LDAP SDK - Available Command-Line Tools》 <a href="https://docs.ldap.com/ldap-sdk/docs/tool-usages/" target="_blank" rel="noopener noreferrer">https://docs.ldap.com/ldap-sdk/docs/tool-usages/</a></li></ol>`,111),d=[h];function p(k,r){return i(),a("div",null,d)}const o=s(t,[["render",p],["__file","2021-03-22-CentOS7部署服务-OpenLDAP.html.vue"]]),A=JSON.parse('{"path":"/posts/Linux/%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2/2021-03-22-CentOS7%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1-OpenLDAP.html","title":"CentOS 7 部署服务 - OpenLDAP 并使用 Windows AD 做认证源","lang":"zh-CN","frontmatter":{"title":"CentOS 7 部署服务 - OpenLDAP 并使用 Windows AD 做认证源","shortTitle":"CentOS 7 部署服务 - OpenLDAP","description":"部署 OpenLDAP 服务使用 Windows AD 的认证，只在 AD 上维护一套用户密码，OpenLDAP 将认证转发到微软 AD 上进行。","icon":"fab fa-centos","author":"昌霖学长","isOriginal":true,"date":"2021-03-22T00:00:00.000Z","categories":["Linux","服务部署"],"tags":["OpenLDAP","Windows AD","Active Directory"],"license":"MIT","sticky":false,"star":false,"article":true,"timeline":true,"head":[["meta",{"property":"og:url","content":"https://shawnlyu1990.github.io/posts/Linux/%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2/2021-03-22-CentOS7%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1-OpenLDAP.html"}],["meta",{"property":"og:site_name","content":"昌霖学长的折腾笔记"}],["meta",{"property":"og:title","content":"CentOS 7 部署服务 - OpenLDAP 并使用 Windows AD 做认证源"}],["meta",{"property":"og:description","content":"部署 OpenLDAP 服务使用 Windows AD 的认证，只在 AD 上维护一套用户密码，OpenLDAP 将认证转发到微软 AD 上进行。"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://shawnlyu1990.github.io/assets/postsimages/2021-03-22-CentOS7部署服务-OpenLDAP/01-登录phpldapadmin-1.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-21T05:02:02.000Z"}],["meta",{"property":"article:author","content":"昌霖学长"}],["meta",{"property":"article:tag","content":"OpenLDAP"}],["meta",{"property":"article:tag","content":"Windows AD"}],["meta",{"property":"article:tag","content":"Active Directory"}],["meta",{"property":"article:published_time","content":"2021-03-22T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-08-21T05:02:02.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"CentOS 7 部署服务 - OpenLDAP 并使用 Windows AD 做认证源\\",\\"image\\":[\\"https://shawnlyu1990.github.io/assets/postsimages/2021-03-22-CentOS7部署服务-OpenLDAP/01-登录phpldapadmin-1.png\\",\\"https://shawnlyu1990.github.io/assets/postsimages/2021-03-22-CentOS7部署服务-OpenLDAP/02-登录phpldapadmin-2.png\\"],\\"datePublished\\":\\"2021-03-22T00:00:00.000Z\\",\\"dateModified\\":\\"2024-08-21T05:02:02.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"昌霖学长\\"}]}"]]},"headers":[{"level":2,"title":"1. 背景","slug":"_1-背景","link":"#_1-背景","children":[]},{"level":2,"title":"2. 相关组件","slug":"_2-相关组件","link":"#_2-相关组件","children":[]},{"level":2,"title":"3. 部署","slug":"_3-部署","link":"#_3-部署","children":[{"level":3,"title":"3.1. 安装 OpenLdap","slug":"_3-1-安装-openldap","link":"#_3-1-安装-openldap","children":[]},{"level":3,"title":"3.2. 部署 Saslauthd","slug":"_3-2-部署-saslauthd","link":"#_3-2-部署-saslauthd","children":[]},{"level":3,"title":"3.3. 安装 phpldapadmin","slug":"_3-3-安装-phpldapadmin","link":"#_3-3-安装-phpldapadmin","children":[]},{"level":3,"title":"3.4. 测试 OpenLDAP 使用 AD 密码进行认证","slug":"_3-4-测试-openldap-使用-ad-密码进行认证","link":"#_3-4-测试-openldap-使用-ad-密码进行认证","children":[]}]},{"level":2,"title":"4. 参考","slug":"_4-参考","link":"#_4-参考","children":[]}],"git":{"createdTime":1723779818000,"updatedTime":1724216522000,"contributors":[{"name":"Shawn Lyu","email":"shawnlyu1990@gmail.com","commits":2}]},"readingTime":{"minutes":11.42,"words":3426},"filePathRelative":"posts/Linux/服务部署/2021-03-22-CentOS7部署服务-OpenLDAP.md","localizedDate":"2021年3月22日","excerpt":"","copyright":{"license":"MIT"}}');export{o as comp,A as data};
