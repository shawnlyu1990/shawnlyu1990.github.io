import{w as t,z as e,C as a,K as l}from"./app-BxWsmEd9.js";const n="/assets/postsimages/2024-07-08-%E4%B8%89%E5%B1%82%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%8E%E8%B7%AF%E7%94%B1%E5%99%A8/01-%E4%B8%89%E5%B1%82%E8%BD%AC%E5%8F%91%E5%8E%9F%E7%90%86%E7%A4%BA%E6%84%8F%E5%9B%BE.jpeg",r={},i=l('<div class="hint-container important"><p class="hint-container-title">重要</p><p>本博客系个人学习笔记，内容源自公开出版物及网络资源，如有侵权，请通过左下角 ✉️ 联系删除。</p></div><h2 id="_1-三层交换机" tabindex="-1"><a class="header-anchor" href="#_1-三层交换机"><span>1. 三层交换机</span></a></h2><h3 id="_1-1-三层交换机出现的背景" tabindex="-1"><a class="header-anchor" href="#_1-1-三层交换机出现的背景"><span>1.1. 三层交换机出现的背景</span></a></h3><p>早期的网络中一般使用二层交换机来搭建局域网，而不同局域网之间的网络互通由路由器来完成。那时的网络流量，局域网内部的流量占了绝大部分，而网络间的通信访问量比较少，使用少量路由器已经足够应付了。</p><p>但是，随着数据通信网络范围的不断扩大，网络业务的不断丰富，网络间互访的需求越来越大，而路由器由于自身成本高、转发性能低、接口数量少等特点无法很好的满足网络发展的需求。因此出现了三层交换机这样一种能实现高速三层转发的设备。</p><p>当然，三层交换机并不能完全替代路由器，路由器所具备的丰富的接口类型、良好的流量服务等级控制、强大的路由能力等仍然是三层交换机的薄弱环节。</p><h3 id="_1-2-三层转发原理" tabindex="-1"><a class="header-anchor" href="#_1-2-三层转发原理"><span>1.2. 三层转发原理</span></a></h3><p>目前的三层交换机一般是通过 VLAN 来划分二层网络并实现二层交换，同时能够实现不同 VLAN 间的三层 IP 互访。不同网络的主机之间互访的流程简要概述如下：</p><p>源主机在发起通信之前，将自己的 IP 与目的主机的 IP 进行比较，如果两者位于同一网段（用网络掩码计算后具有相同的网络号），那么源主机直接向目的主机发送 ARP 请求，在收到目的主机的 ARP 应答后获得对方的物理层（MAC）地址，然后用对方 MAC 地址作为报文的目的 MAC 地址进行报文发送。</p><p>当源主机判断目的主机与自己位于不同网段时，它会通过网关（Gateway）来递交报文，即发送 ARP 请求来获取网关 IP 地址对应的 MAC，在得到网关的 ARP 应答后，用网关 MAC 作为报文的目的 MAC 发送报文。此时发送报文的源 IP 是源主机的 IP，目的 IP 仍然是目的主机的 IP。</p><p>下面详细介绍一下三层交换的过程。</p><p>如下图所示，通信的源、目的主机连接在同一台三层交换机上，但它们位于不同 VLAN（网段）。对于三层交换机来说，这两台主机都位于它的直连网段内，它们的 IP 对应的路由都是直连路由。</p><figure><img src="'+n+'" alt="三层转发原理示意图" tabindex="0" loading="lazy"><figcaption>三层转发原理示意图</figcaption></figure><p>图中标明了两台主机的 MAC、IP 地址、网关，以及三层交换机的 MAC、不同 VLAN 配置的三层接口 IP。当 PC A 向 PC B 发起 PING 时，流程如下：（假设三层交换机上还未建立任何硬件转发表项）</p><ol><li>根据前面的描述，PC A 首先检查出目的 IP 地址 10.2.1.2（PC B）与自己不在同一网段，因此它发出请求网关地址 10.1.1.1 对应 MAC 的 ARP 请求；</li><li>L3 Switch 收到 PC A 的 ARP 请求后，检查请求报文发现被请求 IP 是自己的三层接口 IP，因此发送 ARP 应答并将自己的三层接口 MAC（MAC Switch）包含在其中。同时它还会把 PC A 的 IP 地址与 MAC 地址对应（10.1.1.2 与 MAC A）关系记录到自己的 ARP 表项中去（因为 ARP 请求报文中包含了发送者的 IP 和 MAC）；</li><li>PC A 得到网关（L3 Switch）的 ARP 应答后，组装 ICMP 请求报文并发送，报文的目的 MAC（即 DMAC）＝MAC Switch、源 MAC（即 SMAC）＝MAC A、源 IP（即 SIP）＝10.1.1.2、目的IP（即 DIP）＝10.2.1.2；</li><li>L3 Switch 收到报文后，首先根据报文的源 MAC + VLAN ID 更新 MAC 表。然后，根据报文的目的 MAC ＋ VLAN ID 查找 MAC 地址表，发现匹配了自己三层接口 MAC 的表项，说明需要作三层转发，于是继续查找交换芯片的三层表项；</li><li>交换芯片根据报文的目的 IP 去查找其三层表项，由于之前未建立任何表项，因此查找失败，于是将报文送到 CPU 去进行软件处理；</li><li>CPU 根据报文的目的 IP 去查找其软件路由表，发现匹配了一个直连网段（PC B 对应的网段），于是继续查找其软件 ARP 表，仍然查找失败。然后 L3 Switch 会在目的网段对应的 VLAN 3 的所有接口发送请求地址 10.2.1.2 对应 MAC 的 ARP 请求；</li><li>PC B 收到 L3 Switch 发送的 ARP 请求后，检查发现被请求 IP 是自己的 IP，因此发送 ARP 应答并将自己的 MAC（MAC B）包含在其中。同时，将 L3 Switch 的 IP 与 MAC 的对应关系（10.2.1.1 与 MAC Switch）记录到自己的 ARP 表中去；</li><li>L3 Switch 收到 PC B 的 ARP 应答后，将其 IP 和 MAC 对应关系（10.2.1.2 与 MAC B）记录到自己的 ARP 表中去，并将 PC A 的 ICMP 请求报文发送给 PC B，报文的目的 MAC 修改为 PC B 的 MAC（MAC B），源 MAC 修改为自己的 MAC（MAC Switch）。同时，在交换芯片的三层表项中根据刚得到的三层转发信息添加表项（内容包括 IP、MAC、出口 VLAN、出接口），这样后续的 PC A 发往 PC B 的报文就可以通过该硬件三层表项直接转发了；</li><li>PC B 收到 L3 Switch 转发过来的 ICMP 请求报文以后，回应 ICMP 应答给 PC A。ICMP 应答报文的转发过程与前面类似，只是由于 L3 Switch 在之前已经得到 PC A 的 IP 和 MAC 对应关系了，也同时在交换芯片中添加了相关三层表项，因此这个报文直接由交换芯片硬件转发给 PC A；</li><li>这样，后续的往返报文都经过查 MAC 表到查三层转发表的过程由交换芯片直接进行硬件转发了。</li></ol><p>从上述流程可以看出，三层交换机正是充分利用了「一次路由（首包 CPU 转发并建立三层硬件表项）、多次交换（后续包芯片硬件转发）」的原理实现了转发性能与三层交换的完美统一。</p><h2 id="_2-路由器" tabindex="-1"><a class="header-anchor" href="#_2-路由器"><span>2. 路由器</span></a></h2><h3 id="_2-1-什么是路由器" tabindex="-1"><a class="header-anchor" href="#_2-1-什么是路由器"><span>2.1. 什么是路由器？</span></a></h3><p>路由（Routing）是数据通信网络中一个基本的概念。路由就是通过互联的网络把信息从源地址传输到目的地址的活动。路由发生在OSI网络参考模型中的第三层（即网络层）。我们将具有路由转发功能的设备称为广义上的路由器。</p><p>当路由器收到一个IP数据包，路由器会根据目的IP地址在设备上的路由表（Routing Table）中进行查找，找到“最匹配”的路由条目后，将数据包根据路由条目所指示的出接口或下一跳IP转发出去。路由表中装载着路由器通过各种途径获知的路由条目（Routes）。路由器可通过静态、动态等方式获取路由条目并维护自己的路由表。</p><h3 id="_2-2-路由器的工作原理" tabindex="-1"><a class="header-anchor" href="#_2-2-路由器的工作原理"><span>2.2. 路由器的工作原理</span></a></h3><p>路由器是一种典型的网络连接设备，用来进行路由选择和报文转发。路由器根据收到报文的目的地址选择一条合适的路径（包含一个或多个路由器的网络），然后将报文传送到下一个路由器，路径终端的路由器负责将报文送交目的主机。</p><p>路由就是报文从源端到目的端的路径。当报文从路由器到目的网段有多条路由可达时，路由器可以根据路由表中最佳路由进行转发。最佳路由的选取与发现此路由的路由协议的优先级、路由的度量有关。当多条路由的协议优先级与路由度量都相同时，可以实现负载分担，缓解网络压力；当多条路由的协议优先级与路由度量不同时，可以构成路由备份，提高网络的可靠性。</p><h2 id="_3-路由器-vs-三层交换机" tabindex="-1"><a class="header-anchor" href="#_3-路由器-vs-三层交换机"><span>3. 路由器 VS 三层交换机</span></a></h2><h3 id="_3-1-接口类型" tabindex="-1"><a class="header-anchor" href="#_3-1-接口类型"><span>3.1. 接口类型</span></a></h3><p>路由器具有非常强大的网络连接和路由功能，它可以与各种各样的不同网络进行物理连接，这就决定了路由器的接口技术非常复杂，越是高档的路由器其接口种类也就越多，因为它所能连接的网络类型越多。路由器的端口主要分局域网端口、广域网端口和配置端口三类。</p><ul><li><strong>局域网接口</strong>：常见的以太网接口主要有 AUI、BNC 和 RJ-45 接口，SFP 光口，还有 FDDI、ATM、千兆以太网等都有相应的网络接口。</li><li><strong>广域网接口</strong>：路由器不仅能实现局域网之间连接，更重要的应用还是在于局域网与广域网、广域网与广域网之间的连接。但是因为广域网规模大，网络环境复杂，所以也就决定了路由器用于连接广域网的端口的速率要求非常高，在以太网中一般都要求在100Mbps快速以太网以上。几种常见的广域网接口包括：RJ-45 接口、SFP 光口、AUI 接口、高速同步串口、异步串口、ISDN BRI 接口。</li><li><strong>配置接口</strong>：主要以 Console 口为主，通常是用来进行路由器的基本配置时通过专用连线与计算机连用的。部分机器还有 AUX 接口用于路由器的远程配置连接使用。</li></ul><p>相对而言三层交换机支持的网络类型很少，主要集中在 RJ-45 接口，SFP 光口两个类别。对于串行接口（同步串口、异步串口），ATM，这些口一般三层交换机支持的都很差，有些大型交换机会用专门的一个板卡提供这些网络接口的支持。路由器则不一样，一个核心路由器通常是带一堆各种各样的接口，反而是以太网口不太多。虽然如今大部分线路都改造成光纤了，但在运营商那边，串行链路还是很多的，所以在运营商的核心网中，仍然是以路由器为主。</p><h3 id="_3-2-qos-特性、会话控制等高级功能" tabindex="-1"><a class="header-anchor" href="#_3-2-qos-特性、会话控制等高级功能"><span>3.2. QoS 特性、会话控制等高级功能</span></a></h3><p>现代路由器已经不仅仅是工作在三层的网络设备，而是同时工作在 OSI 模型三、四层的网络设备，他不但可以根据 IP 包头对数据包进行路由，而且可以根据会话去控制连接，可以根据数据的 QoS 特性决定数据包的转发优先级，还有许多其他的包括连接复用、负载分担、链路备份、加密、压缩、防火墙等功能。因为路由器所有报文都走 CPU，所以 CPU 有能力针对报文的三、四层信息进行管控（当然了包括防火墙设备、流控设备、行为管理设备等更高层的设备可以在更高层的位置对数据进行管控，这里不在我们讨论之列）。但交换机的交换芯片则没有这个能力，因为交换芯片太快了。路由器的这个特点，也用在了很多企业、ISP 的出口网络上。</p><h3 id="_3-3-数据处理方式" tabindex="-1"><a class="header-anchor" href="#_3-3-数据处理方式"><span>3.3 数据处理方式</span></a></h3><p>三层交换机的首包通过 CPU 转发，同时通过 ARP 协议建立交换芯片硬件表项（MAC 地址与 IP 地址的映射表），后续报文通过交换芯片直接硬件转发，即「一次路由，多次交换」，交换机的硬件三层表项中只包含了目的地址、下一跳IP对应的MAC地址、出口VLAN及端口。</p><p>路由器通过路由表选择路由后，路由表将激活路由下发到 FIB（转发信息表）表中，数据在到达路由器时，通过 FIB 表的最长匹配原则查表转发。</p><p>所以三层交换机在数据转发上的速度要优于路由器。</p><h3 id="_3-3-其他能力" tabindex="-1"><a class="header-anchor" href="#_3-3-其他能力"><span>3.3. 其他能力</span></a></h3><table><thead><tr><th style="text-align:center;">属性</th><th style="text-align:center;">三层交换机</th><th style="text-align:center;">路由器</th></tr></thead><tbody><tr><td style="text-align:center;">范围</td><td style="text-align:center;">局域网</td><td style="text-align:center;">广域网</td></tr><tr><td style="text-align:center;">主要功能</td><td style="text-align:center;">跨园区局域网上不同子网或 VLAN 间路由</td><td style="text-align:center;">跨广域网的不同网络的间的路由和通信</td></tr><tr><td style="text-align:center;">边界技术</td><td style="text-align:center;">不支持或少量支持</td><td style="text-align:center;">NAT、防火墙、隧道、VPN 等</td></tr><tr><td style="text-align:center;">路由表大小</td><td style="text-align:center;">与路由器相比更小的路由表</td><td style="text-align:center;">大得多，以支持多个路由条目</td></tr><tr><td style="text-align:center;">转发决策</td><td style="text-align:center;">转发由专门的 ASIC 执行</td><td style="text-align:center;">由软件执行</td></tr><tr><td style="text-align:center;">接口支持</td><td style="text-align:center;">RJ-45、FSP 光口为主</td><td style="text-align:center;">RJ-45、FSP 光口、同步串行端口、异步串行端口、SONT、OC-N、T1/T3 等</td></tr><tr><td style="text-align:center;">吞吐量</td><td style="text-align:center;">高吞吐量</td><td style="text-align:center;">低于三层交换机</td></tr><tr><td style="text-align:center;">开关容量</td><td style="text-align:center;">高开关容量</td><td style="text-align:center;">低于三层交换机</td></tr><tr><td style="text-align:center;">成本</td><td style="text-align:center;">低</td><td style="text-align:center;">高</td></tr><tr><td style="text-align:center;">端口密度</td><td style="text-align:center;">高</td><td style="text-align:center;">低</td></tr></tbody></table><h2 id="_4-总结" tabindex="-1"><a class="header-anchor" href="#_4-总结"><span>4. 总结</span></a></h2><p>就像最开始说到的，三层交换机并不能完全替代路由器，但确实已经将路由器边缘化了。</p><p>三层交换机在某些情况下可以取代路由器，但这主要取决于网络的需求和规模。在大型企业网络中，三层交换机通常用于核心网络或分布层，负责处理大量的内部数据流量，而路由器则位于网络的边缘，负责连接到互联网或其他外部网络。</p><p>三层交换机具有路由功能，可以在不同的VLAN或子网之间进行数据包的转发。然而，与全功能的路由器相比，它们可能缺乏一些高级功能，如防火墙、VPN、QoS等。</p><p>因此，如果你的网络需求主要是内部的数据流量转发，并且不需要路由器的高级功能，那么三层交换机可能是一个更经济、更高效的选择。然而，如果你需要连接到外部网络，或者需要使用到路由器的高级功能，那么你可能仍然需要一个路由器。</p><p>三层交换机和路由器在网络中各有其角色和优势，选择使用哪种设备主要取决于你的具体需求和网络环境。</p><h2 id="_5-参考资料" tabindex="-1"><a class="header-anchor" href="#_5-参考资料"><span>5. 参考资料</span></a></h2><ol><li>《S300, S500, S2700, S5700, S6700 V200R021C00, C01 配置指南-以太网交换》<a href="https://support.huawei.com/enterprise/zh/doc/EDOC1100213108/61acef27" target="_blank" rel="noopener noreferrer">https://support.huawei.com/enterprise/zh/doc/EDOC1100213108/61acef27</a></li><li>《路由协议基础》<a href="https://support.huawei.com/enterprise/zh/doc/EDOC1100087024#ZH-CN_TOPIC_0165239069" target="_blank" rel="noopener noreferrer">https://support.huawei.com/enterprise/zh/doc/EDOC1100087024#ZH-CN_TOPIC_0165239069</a></li><li>《路由器端口介绍》<a href="https://blog.csdn.net/lee_jessica/article/details/107494714" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/lee_jessica/article/details/107494714</a></li><li>《为什么三层交换机无法替代路由器？》<a href="https://www.cnblogs.com/Renyi-Fan/p/8093091.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/Renyi-Fan/p/8093091.html</a></li><li>《三层交换机功能那么强大，还需要路由器吗？》<a href="https://zhuanlan.zhihu.com/p/690620274" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/690620274</a></li><li>《三层交换机和路由器的区别》<a href="https://forum.huawei.com/enterprise/zh/thread/580883608879644672" target="_blank" rel="noopener noreferrer">https://forum.huawei.com/enterprise/zh/thread/580883608879644672</a></li></ol>',44),s=[i];function p(o,c){return e(),a("div",null,s)}const d=t(r,[["render",p],["__file","2024-07-08-三层交换机与路由器.html.vue"]]),A=JSON.parse('{"path":"/posts/Network/%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2/2024-07-08-%E4%B8%89%E5%B1%82%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%8E%E8%B7%AF%E7%94%B1%E5%99%A8.html","title":"【学习笔记】三层交换机与路由器的区别","lang":"zh-CN","frontmatter":{"title":"【学习笔记】三层交换机与路由器的区别","shortTitle":"三层交换机与路由器的区别","description":"说到三层交换机和路由器，我一直都对这两个设备感到困惑，因为它们都接收 IP 数据包，检查目标地址并根据路由规则传递数据包。三层交换机似乎完全可以替代路由器的工作。但似乎在实际应用中，三层交换机和路由器在很多方面都存在一些差异，我们这里就讨论一下这些问题……","icon":"Router","author":"昌霖学长","isOriginal":true,"date":"2024-07-08T00:00:00.000Z","categories":["网络","路由交换"],"tags":["路由器","三层交换机"],"license":"MIT","sticky":false,"star":false,"article":true,"timeline":true,"head":[["meta",{"property":"og:url","content":"https://shawnlyu1990.github.io/posts/Network/%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2/2024-07-08-%E4%B8%89%E5%B1%82%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%8E%E8%B7%AF%E7%94%B1%E5%99%A8.html"}],["meta",{"property":"og:site_name","content":"知识杂货铺"}],["meta",{"property":"og:title","content":"【学习笔记】三层交换机与路由器的区别"}],["meta",{"property":"og:description","content":"说到三层交换机和路由器，我一直都对这两个设备感到困惑，因为它们都接收 IP 数据包，检查目标地址并根据路由规则传递数据包。三层交换机似乎完全可以替代路由器的工作。但似乎在实际应用中，三层交换机和路由器在很多方面都存在一些差异，我们这里就讨论一下这些问题……"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://shawnlyu1990.github.io/assets/postsimages/2024-07-08-三层交换机与路由器/01-三层转发原理示意图.jpeg"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-09-02T05:44:26.000Z"}],["meta",{"property":"article:author","content":"昌霖学长"}],["meta",{"property":"article:tag","content":"路由器"}],["meta",{"property":"article:tag","content":"三层交换机"}],["meta",{"property":"article:published_time","content":"2024-07-08T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-09-02T05:44:26.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"【学习笔记】三层交换机与路由器的区别\\",\\"image\\":[\\"https://shawnlyu1990.github.io/assets/postsimages/2024-07-08-三层交换机与路由器/01-三层转发原理示意图.jpeg\\"],\\"datePublished\\":\\"2024-07-08T00:00:00.000Z\\",\\"dateModified\\":\\"2024-09-02T05:44:26.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"昌霖学长\\"}]}"]]},"headers":[{"level":2,"title":"1. 三层交换机","slug":"_1-三层交换机","link":"#_1-三层交换机","children":[{"level":3,"title":"1.1. 三层交换机出现的背景","slug":"_1-1-三层交换机出现的背景","link":"#_1-1-三层交换机出现的背景","children":[]},{"level":3,"title":"1.2. 三层转发原理","slug":"_1-2-三层转发原理","link":"#_1-2-三层转发原理","children":[]}]},{"level":2,"title":"2. 路由器","slug":"_2-路由器","link":"#_2-路由器","children":[{"level":3,"title":"2.1. 什么是路由器？","slug":"_2-1-什么是路由器","link":"#_2-1-什么是路由器","children":[]},{"level":3,"title":"2.2. 路由器的工作原理","slug":"_2-2-路由器的工作原理","link":"#_2-2-路由器的工作原理","children":[]}]},{"level":2,"title":"3. 路由器 VS 三层交换机","slug":"_3-路由器-vs-三层交换机","link":"#_3-路由器-vs-三层交换机","children":[{"level":3,"title":"3.1. 接口类型","slug":"_3-1-接口类型","link":"#_3-1-接口类型","children":[]},{"level":3,"title":"3.2. QoS 特性、会话控制等高级功能","slug":"_3-2-qos-特性、会话控制等高级功能","link":"#_3-2-qos-特性、会话控制等高级功能","children":[]},{"level":3,"title":"3.3 数据处理方式","slug":"_3-3-数据处理方式","link":"#_3-3-数据处理方式","children":[]},{"level":3,"title":"3.3. 其他能力","slug":"_3-3-其他能力","link":"#_3-3-其他能力","children":[]}]},{"level":2,"title":"4. 总结","slug":"_4-总结","link":"#_4-总结","children":[]},{"level":2,"title":"5. 参考资料","slug":"_5-参考资料","link":"#_5-参考资料","children":[]}],"git":{"createdTime":1723779818000,"updatedTime":1725255866000,"contributors":[{"name":"Shawn Lyu","email":"shawnlyu1990@gmail.com","commits":3}]},"readingTime":{"minutes":14.02,"words":4205},"filePathRelative":"posts/Network/路由交换/2024-07-08-三层交换机与路由器.md","localizedDate":"2024年7月8日","excerpt":"","copyright":{"license":"MIT"}}');export{d as comp,A as data};
