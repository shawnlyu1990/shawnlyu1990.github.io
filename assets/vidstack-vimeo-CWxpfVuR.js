var j=u=>{throw TypeError(u)};var M=(u,t,e)=>t.has(u)||j("Cannot "+e);var s=(u,t,e)=>(M(u,t,"read from private field"),e?e.call(u):t.get(u)),d=(u,t,e)=>t.has(u)?j("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(u):t.set(u,e),o=(u,t,e,a)=>(M(u,t,"write to private field"),a?a.call(u,e):t.set(u,e),e),r=(u,t,e)=>(M(u,t,"access private method"),e);import{resolveVimeoVideoId as ut,getVimeoVideoInfo as ct}from"./vidstack-R6KXDDHL-D2mVDJmX.js";import{g as dt}from"./vidstack-MB353KSX-aLJ4nyI7.js";import{y as ft,R as S,h as P,e as gt,g as pt,F as R,A as x,L as yt,W as _,c as I,s as bt,I as kt,x as vt,b as B}from"./app-CnnfdaU7.js";var mt=["bufferend","bufferstart","durationchange","ended","enterpictureinpicture","error","fullscreenchange","leavepictureinpicture","loaded","playProgress","loadProgress","pause","play","playbackratechange","qualitychange","seeked","seeking","timeupdate","volumechange","waiting"],h,f,p,k,w,C,y,$,V,v,b,T,i,W,Y,z,G,m,H,J,K,A,U,X,Z,tt,et,D,st,it,at,E,ht,F,rt,L,nt,ot,l,O,Q,N,Ct=(N=class extends dt{constructor(t,e){super(t);d(this,i);d(this,h);d(this,f);d(this,p);d(this,k);d(this,w);d(this,C);d(this,y);d(this,$);d(this,V);d(this,v);d(this,b);d(this,T);d(this,m);this.$$PROVIDER_TYPE="VIMEO",this.scope=ft(),o(this,f,S("")),o(this,p,S(!1)),o(this,k,null),o(this,w,null),o(this,C,!1),o(this,y,new P(0,0)),o(this,$,new gt(r(this,i,G).bind(this))),o(this,V,null),o(this,v,null),o(this,b,new Map),o(this,T,null),this.cookies=!1,this.title=!0,this.byline=!0,this.portrait=!0,this.color="00ADEF",o(this,m,!1),o(this,h,e);let a=this;this.fullscreen={get active(){return s(a,C)},supported:!0,enter:()=>r(this,i,l).call(this,"requestFullscreen"),exit:()=>r(this,i,l).call(this,"exitFullscreen")}}get type(){return"vimeo"}get currentSrc(){return s(this,w)}get videoId(){return s(this,f).call(this)}get hash(){return s(this,k)}get isPro(){return s(this,p).call(this)}preconnect(){pt(this.getOrigin())}setup(){super.setup(),R(r(this,i,W).bind(this)),R(r(this,i,Y).bind(this)),R(r(this,i,z).bind(this)),s(this,h).notify("provider-setup",this)}destroy(){r(this,i,O).call(this),this.fullscreen=void 0;let t="provider destroyed";for(let e of s(this,b).values())for(let{reject:a}of e)a(t);s(this,b).clear(),r(this,i,l).call(this,"destroy")}async play(){return r(this,i,l).call(this,"play")}async pause(){return r(this,i,l).call(this,"pause")}setMuted(t){r(this,i,l).call(this,"setMuted",t)}setCurrentTime(t){r(this,i,l).call(this,"seekTo",t),s(this,h).notify("seeking",t)}setVolume(t){r(this,i,l).call(this,"setVolume",t),r(this,i,l).call(this,"setMuted",x(s(this,h).$state.muted))}setPlaybackRate(t){r(this,i,l).call(this,"setPlaybackRate",t)}async loadSource(t){if(!yt(t.src)){o(this,w,null),o(this,k,null),s(this,f).set("");return}let{videoId:e,hash:a}=ut(t.src);s(this,f).set(e??""),o(this,k,a??null),o(this,w,t)}getOrigin(){return"https://player.vimeo.com"}buildParams(){let{keyDisabled:t}=s(this,h).$props,{playsInline:e,nativeControls:a}=s(this,h).$state,n=a();return{title:this.title,byline:this.byline,color:this.color,portrait:this.portrait,controls:n,h:this.hash,keyboard:n&&!t(),transparent:!0,playsinline:e(),dnt:!this.cookies}}onMessage(t,e){t.event?r(this,i,nt).call(this,t.event,t.data,e):t.method&&r(this,i,U).call(this,t.method,t.value,e)}onLoad(){}},h=new WeakMap,f=new WeakMap,p=new WeakMap,k=new WeakMap,w=new WeakMap,C=new WeakMap,y=new WeakMap,$=new WeakMap,V=new WeakMap,v=new WeakMap,b=new WeakMap,T=new WeakMap,i=new WeakSet,W=function(){r(this,i,O).call(this);let t=s(this,f).call(this);if(!t){this.src.set("");return}this.src.set(`${this.getOrigin()}/video/${t}`),s(this,h).notify("load-start")},Y=function(){let t=s(this,f).call(this);if(!t)return;let e=_(),a=new AbortController;return o(this,T,e),ct(t,a,s(this,k)).then(n=>{e.resolve(n)}).catch(n=>{e.reject()}),()=>{e.reject(),a.abort()}},z=function(){let t=s(this,p).call(this),{$state:e,qualities:a}=s(this,h);if(e.canSetPlaybackRate.set(t),a[I.setReadonly](!t),t)return bt(a,"change",()=>{var c;if(a.auto)return;let n=(c=a.selected)==null?void 0:c.id;n&&r(this,i,l).call(this,"setQuality",n)})},G=function(){r(this,i,l).call(this,"getCurrentTime")},m=new WeakMap,H=function(t,e){if(s(this,m)&&t===0)return;let{realCurrentTime:a,realDuration:n,paused:c,bufferedEnd:g}=s(this,h).$state;if(a()===t)return;let q=a();s(this,h).notify("time-change",t,e),Math.abs(q-t)>1.5&&(s(this,h).notify("seeking",t,e),!c()&&g()<t&&s(this,h).notify("waiting",void 0,e)),n()-t<.01&&(s(this,h).notify("end",void 0,e),o(this,m,!0),setTimeout(()=>{o(this,m,!1)},500))},J=function(t,e){s(this,h).notify("seeked",t,e)},K=function(t){var a;let e=s(this,f).call(this);(a=s(this,T))==null||a.promise.then(n=>{if(!n)return;let{title:c,poster:g,duration:q,pro:lt}=n;s(this,p).set(lt),s(this,h).notify("title-change",c,t),s(this,h).notify("poster-change",g,t),s(this,h).notify("duration-change",q,t),r(this,i,A).call(this,q,t)}).catch(()=>{e===s(this,f).call(this)&&(r(this,i,l).call(this,"getVideoTitle"),r(this,i,l).call(this,"getDuration"))})},A=function(t,e){let{nativeControls:a}=s(this,h).$state,n=a();o(this,y,new P(0,t));let c={buffered:new P(0,0),seekable:s(this,y),duration:t};s(this,h).delegate.ready(c,e),n||r(this,i,l).call(this,"_hideOverlay"),r(this,i,l).call(this,"getQualities"),r(this,i,l).call(this,"getChapters")},U=function(t,e,a){var n;switch(t){case"getVideoTitle":let c=e;s(this,h).notify("title-change",c,a);break;case"getDuration":let g=e;s(this,h).$state.canPlay()?s(this,h).notify("duration-change",g,a):r(this,i,A).call(this,g,a);break;case"getCurrentTime":r(this,i,H).call(this,e,a);break;case"getBuffered":kt(e)&&e.length&&r(this,i,D).call(this,e[e.length-1][1],a);break;case"setMuted":r(this,i,E).call(this,x(s(this,h).$state.volume),e,a);break;case"getChapters":r(this,i,ht).call(this,e);break;case"getQualities":r(this,i,rt).call(this,e,a);break}(n=r(this,i,Q).call(this,t))==null||n.resolve()},X=function(){for(let t of mt)r(this,i,l).call(this,"addEventListener",t)},Z=function(t){s(this,$).stop(),s(this,h).notify("pause",void 0,t)},tt=function(t){s(this,$).start(),s(this,h).notify("play",void 0,t)},et=function(t){let{paused:e}=s(this,h).$state;!e()&&!s(this,m)&&s(this,h).notify("playing",void 0,t)},D=function(t,e){let a={buffered:new P(0,t),seekable:s(this,y)};s(this,h).notify("progress",a,e)},st=function(t){s(this,h).notify("waiting",void 0,t)},it=function(t){let{paused:e}=s(this,h).$state;e()||s(this,h).notify("playing",void 0,t)},at=function(t){let{paused:e}=s(this,h).$state;e()&&s(this,h).notify("play",void 0,t),s(this,h).notify("waiting",void 0,t)},E=function(t,e,a){let n={volume:t,muted:e};s(this,h).notify("volume-change",n,a)},ht=function(t){if(r(this,i,F).call(this),!t.length)return;let e=new vt({kind:"chapters",default:!0}),{realDuration:a}=s(this,h).$state;for(let n=0;n<t.length;n++){let c=t[n],g=t[n+1];e.addCue(new window.VTTCue(c.startTime,(g==null?void 0:g.startTime)??a(),c.title))}o(this,v,e),s(this,h).textTracks.add(e)},F=function(){s(this,v)&&(s(this,h).textTracks.remove(s(this,v)),o(this,v,null))},rt=function(t,e){s(this,h).qualities[B.enableAuto]=t.some(a=>a.id==="auto")?()=>r(this,i,l).call(this,"setQuality","auto"):void 0;for(let a of t){if(a.id==="auto")continue;let n=+a.id.slice(0,-1);isNaN(n)||s(this,h).qualities[I.add]({id:a.id,width:n*(16/9),height:n,codec:"avc1,h.264",bitrate:-1},e)}r(this,i,L).call(this,t.find(a=>a.active),e)},L=function({id:t}={},e){if(!t)return;let a=t==="auto",n=s(this,h).qualities.getById(t);a?(s(this,h).qualities[B.setAuto](a,e),s(this,h).qualities[I.select](void 0,!0,e)):s(this,h).qualities[I.select](n??void 0,!0,e)},nt=function(t,e,a){switch(t){case"ready":r(this,i,X).call(this);break;case"loaded":r(this,i,K).call(this,a);break;case"play":r(this,i,tt).call(this,a);break;case"playProgress":r(this,i,et).call(this,a);break;case"pause":r(this,i,Z).call(this,a);break;case"loadProgress":r(this,i,D).call(this,e.seconds,a);break;case"waiting":r(this,i,at).call(this,a);break;case"bufferstart":r(this,i,st).call(this,a);break;case"bufferend":r(this,i,it).call(this,a);break;case"volumechange":r(this,i,E).call(this,e.volume,x(s(this,h).$state.muted),a);break;case"durationchange":o(this,y,new P(0,e.duration)),s(this,h).notify("duration-change",e.duration,a);break;case"playbackratechange":s(this,h).notify("rate-change",e.playbackRate,a);break;case"qualitychange":r(this,i,L).call(this,e,a);break;case"fullscreenchange":o(this,C,e.fullscreen),s(this,h).notify("fullscreen-change",e.fullscreen,a);break;case"enterpictureinpicture":s(this,h).notify("picture-in-picture-change",!0,a);break;case"leavepictureinpicture":s(this,h).notify("picture-in-picture-change",!1,a);break;case"ended":s(this,h).notify("end",void 0,a);break;case"error":r(this,i,ot).call(this,e,a);break;case"seek":case"seeked":r(this,i,J).call(this,e.seconds,a);break}},ot=function(t,e){var c;let{message:a,method:n}=t;n==="setPlaybackRate"&&s(this,p).set(!1),n&&((c=r(this,i,Q).call(this,n))==null||c.reject(a))},l=async function(t,e){let a=_(),n=s(this,b).get(t);return n||s(this,b).set(t,n=[]),n.push(a),this.postMessage({method:t,value:e}),a.promise},O=function(){s(this,$).stop(),o(this,y,new P(0,0)),o(this,T,null),o(this,V,null),s(this,p).set(!1),r(this,i,F).call(this)},Q=function(t){var e;return(e=s(this,b).get(t))==null?void 0:e.shift()},N);export{Ct as VimeoProvider};
