var V=t=>{throw TypeError(t)};var H=(t,e,s)=>e.has(t)||V("Cannot "+s);var i=(t,e,s)=>(H(t,e,"read from private field"),s?s.call(t):e.get(t)),g=(t,e,s)=>e.has(t)?V("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),o=(t,e,s,d)=>(H(t,e,"write to private field"),d?d.call(t,s):e.set(t,s),s),r=(t,e,s)=>(H(t,e,"access private method"),s);import{B as wt,L as _,g as vt,A as Et,b as Y,s as U,F as St,_ as M,e as xt,i as C,x as kt,c as I,d as At,H as Lt,j as $t,T as Dt,m as Z,o as Mt,S as Ft,E as Rt,r as Pt}from"./app-0bwqAuuC.js";import{VideoProvider as It}from"./vidstack-video-BzPetA9m.js";import"./vidstack-EIUG4XP7-B0ya2CwA.js";function z(t){try{return new Intl.DisplayNames(navigator.languages,{type:"language"}).of(t)??null}catch{return null}}var _t=t=>`dash-${Pt(t)}`,x,l,n,A,L,a,k,tt,it,et,b,$,st,at,nt,ht,rt,dt,ot,lt,E,ct,O,B,ut,G,pt,gt,Q,W,qt=(W=class{constructor(t,e){g(this,a);g(this,x);g(this,l);g(this,n);g(this,A);g(this,L);g(this,b);g(this,$);g(this,E);o(this,n,null),o(this,A,new Set),o(this,L,null),this.config={},o(this,b,null),o(this,$,{}),o(this,E,-1),o(this,x,t),o(this,l,e)}get instance(){return i(this,n)}setup(t){o(this,n,t().create());let e=r(this,a,et).bind(this);for(let s of Object.values(t.events))i(this,n).on(s,e);i(this,n).on(t.events.ERROR,r(this,a,dt).bind(this));for(let s of i(this,A))s(i(this,n));i(this,l).player.dispatch("dash-instance",{detail:i(this,n)}),i(this,n).initialize(i(this,x),void 0,!1),i(this,n).updateSettings({streaming:{text:{defaultEnabled:!1,dispatchForManualRendering:!0},buffer:{fastSwitchEnabled:!0}},...this.config}),i(this,n).on(t.events.FRAGMENT_LOADING_STARTED,r(this,a,ot).bind(this)),i(this,n).on(t.events.FRAGMENT_LOADING_COMPLETED,r(this,a,lt).bind(this)),i(this,n).on(t.events.MANIFEST_LOADED,r(this,a,rt).bind(this)),i(this,n).on(t.events.QUALITY_CHANGE_RENDERED,r(this,a,ht).bind(this)),i(this,n).on(t.events.TEXT_TRACKS_ADDED,r(this,a,at).bind(this)),i(this,n).on(t.events.TRACK_CHANGE_RENDERED,r(this,a,nt).bind(this)),i(this,l).qualities[Y.enableAuto]=r(this,a,ut).bind(this),U(i(this,l).qualities,"change",r(this,a,pt).bind(this)),U(i(this,l).audioTracks,"change",r(this,a,gt).bind(this)),o(this,L,St(r(this,a,tt).bind(this)))}onInstance(t){return i(this,A).add(t),()=>i(this,A).delete(t)}loadSource(t){var e;r(this,a,Q).call(this),_(t.src)&&((e=i(this,n))==null||e.attachSource(t.src))}destroy(){var t,e;r(this,a,Q).call(this),(t=i(this,n))==null||t.destroy(),o(this,n,null),(e=i(this,L))==null||e.call(this),o(this,L,null)}},x=new WeakMap,l=new WeakMap,n=new WeakMap,A=new WeakMap,L=new WeakMap,a=new WeakSet,k=function(t){return new M(_t(t.type),{detail:t})},tt=function(){if(!i(this,l).$state.live())return;let t=new xt(r(this,a,it).bind(this));return t.start(),t.stop.bind(t)},it=function(){if(!i(this,n))return;let t=i(this,n).duration()-i(this,n).time();i(this,l).$state.liveSyncPosition.set(isNaN(t)?1/0:t)},et=function(t){var e;(e=i(this,l).player)==null||e.dispatch(r(this,a,k).call(this,t))},b=new WeakMap,$=new WeakMap,st=function(t){var c;let e=(c=i(this,b))==null?void 0:c[C.native],s=(e==null?void 0:e.track).cues;if(!e||!s)return;let d=i(this,b).id,f=i(this,$)[d]??0,u=r(this,a,k).call(this,t);for(let y=f;y<s.length;y++){let m=s[y];m.positionAlign||(m.positionAlign="auto"),i(this,b).addCue(m,u)}i(this,$)[d]=s.length},at=function(t){var f;if(!i(this,n))return;let e=t.tracks,s=[...i(this,x).textTracks].filter(u=>"manualMode"in u),d=r(this,a,k).call(this,t);for(let u=0;u<s.length;u++){let c=e[u],y=s[u],m=`dash-${c.kind}-${u}`,p=new kt({id:m,label:(c==null?void 0:c.label)??((f=c.labels.find(h=>h.text))==null?void 0:f.text)??((c==null?void 0:c.lang)&&z(c.lang))??(c==null?void 0:c.lang)??void 0,language:c.lang??void 0,kind:c.kind,default:c.defaultTrack});p[C.native]={managed:!0,track:y},p[C.readyState]=2,p[C.onModeChange]=()=>{i(this,n)&&(p.mode==="showing"?(i(this,n).setTextTrack(u),o(this,b,p)):(i(this,n).setTextTrack(-1),o(this,b,null)))},i(this,l).textTracks.add(p,d)}},nt=function(t){let{mediaType:e,newMediaInfo:s}=t;if(e==="audio"){let d=i(this,l).audioTracks.getById(`dash-audio-${s.index}`);if(d){let f=r(this,a,k).call(this,t);i(this,l).audioTracks[I.select](d,!0,f)}}},ht=function(t){if(t.mediaType!=="video")return;let e=i(this,l).qualities[t.newQuality];if(e){let s=r(this,a,k).call(this,t);i(this,l).qualities[I.select](e,!0,s)}},rt=function(t){if(i(this,l).$state.canPlay()||!i(this,n))return;let{type:e,mediaPresentationDuration:s}=t.data,d=r(this,a,k).call(this,t);i(this,l).notify("stream-type-change",e!=="static"?"live":"on-demand",d),i(this,l).notify("duration-change",s,d),i(this,l).qualities[Y.setAuto](!0,d);let f=i(this,n).getVideoElement(),u=i(this,n).getTracksForTypeFromManifest("video",t.data),c=[...new Set(u.map(h=>h.mimeType))].find(h=>h&&At(f,h)),y=u.filter(h=>c===h.mimeType)[0],m=i(this,n).getTracksForTypeFromManifest("audio",t.data),p=[...new Set(m.map(h=>h.mimeType))].find(h=>h&&Lt(f,h));if(m=m.filter(h=>p===h.mimeType),y.bitrateList.forEach((h,N)=>{var j;let P={id:((j=h.id)==null?void 0:j.toString())??`dash-bitrate-${N}`,width:h.width??0,height:h.height??0,bitrate:h.bandwidth??0,codec:y.codec,index:N};i(this,l).qualities[I.add](P,d)}),$t(y.index)){let h=i(this,l).qualities[y.index];h&&i(this,l).qualities[I.select](h,!0,d)}m.forEach((h,N)=>{let P=h.labels.find(K=>navigator.languages.some(bt=>K.lang&&bt.toLowerCase().startsWith(K.lang.toLowerCase())))||h.labels[0],j={id:`dash-audio-${h==null?void 0:h.index}`,label:(P==null?void 0:P.text)??(h.lang&&z(h.lang))??h.lang??"",language:h.lang??"",kind:"main",mimeType:h.mimeType,codec:h.codec,index:N};i(this,l).audioTracks[I.add](j,d)}),f.dispatchEvent(new M("canplay",{trigger:d}))},dt=function(t){let{type:e,error:s}=t;switch(s.code){case 27:r(this,a,ct).call(this,s);break;default:r(this,a,B).call(this,s);break}},ot=function(){i(this,E)>=0&&r(this,a,O).call(this)},lt=function(t){t.mediaType==="text"&&requestAnimationFrame(r(this,a,st).bind(this,t))},E=new WeakMap,ct=function(t){var e;r(this,a,O).call(this),(e=i(this,n))==null||e.play(),o(this,E,window.setTimeout(()=>{o(this,E,-1),r(this,a,B).call(this,t)},5e3))},O=function(){clearTimeout(i(this,E)),o(this,E,-1)},B=function(t){i(this,l).notify("error",{message:t.message??"",code:1,error:t})},ut=function(){var e;r(this,a,G).call(this,"video",!0);let{qualities:t}=i(this,l);(e=i(this,n))==null||e.setQualityFor("video",t.selectedIndex,!0)},G=function(t,e){var s;(s=i(this,n))==null||s.updateSettings({streaming:{abr:{autoSwitchBitrate:{[t]:e}}}})},pt=function(){let{qualities:t}=i(this,l);!i(this,n)||t.auto||!t.selected||(r(this,a,G).call(this,"video",!1),i(this,n).setQualityFor("video",t.selectedIndex,t.switch==="current"),Dt&&(i(this,x).currentTime=i(this,x).currentTime))},gt=function(){if(!i(this,n))return;let{audioTracks:t}=i(this,l),e=i(this,n).getTracksFor("audio").find(s=>t.selected&&t.selected.id===`dash-audio-${s.index}`);e&&i(this,n).setCurrentTrack(e)},Q=function(){r(this,a,O).call(this),o(this,b,null),o(this,$,{})},W),D,w,q,v,ft,yt,mt,Tt,X,Nt=(X=class{constructor(t,e,s){g(this,v);g(this,D);g(this,w);g(this,q);o(this,D,t),o(this,w,e),o(this,q,s),r(this,v,ft).call(this)}},D=new WeakMap,w=new WeakMap,q=new WeakMap,v=new WeakSet,ft=async function(){let t={onLoadStart:r(this,v,yt).bind(this),onLoaded:r(this,v,mt).bind(this),onLoadError:r(this,v,Tt).bind(this)},e=await Ct(i(this,D),t);return Z(e)&&!_(i(this,D))&&(e=await jt(i(this,D),t)),e?window.dashjs.supportsMediaSource()?e:(i(this,w).player.dispatch(new M("dash-unsupported")),i(this,w).notify("error",{message:"[vidstack] `dash.js` is not supported in this environment",code:4}),null):null},yt=function(){i(this,w).player.dispatch(new M("dash-lib-load-start"))},mt=function(t){i(this,w).player.dispatch(new M("dash-lib-loaded",{detail:t})),i(this,q).call(this,t)},Tt=function(t){let e=Mt(t);i(this,w).player.dispatch(new M("dash-lib-load-error",{detail:e})),i(this,w).notify("error",{message:e.message,code:4,error:e})},X);async function jt(t,e={}){var s,d,f,u,c,y,m;if(!Z(t)){if((s=e.onLoadStart)==null||s.call(e),Ot(t))return(d=e.onLoaded)==null||d.call(e,t),t;if(J(t)){let p=t.MediaPlayer;return(f=e.onLoaded)==null||f.call(e,p),p}try{let p=(u=await t())==null?void 0:u.default;if(J(p))return(c=e.onLoaded)==null||c.call(e,p.MediaPlayer),p.MediaPlayer;if(p)(y=e.onLoaded)==null||y.call(e,p);else throw Error("");return p}catch(p){(m=e.onLoadError)==null||m.call(e,p)}}}async function Ct(t,e={}){var s,d,f;if(_(t)){(s=e.onLoadStart)==null||s.call(e);try{if(await Ft(t),!Rt(window.dashjs.MediaPlayer))throw Error("");let u=window.dashjs.MediaPlayer;return(d=e.onLoaded)==null||d.call(e,u),u}catch(u){(f=e.onLoadError)==null||f.call(e,u)}}}function Ot(t){return t&&t.prototype&&t.prototype!==Function}function J(t){return t&&"MediaPlayer"in t}var Ht="https://cdn.jsdelivr.net",F,T,S,R,Vt=(R=class extends It{constructor(){super(...arguments);g(this,F);g(this,T);g(this,S);this.$$PROVIDER_TYPE="DASH",o(this,F,null),o(this,T,new qt(this.video,this.ctx)),o(this,S,`${Ht}/npm/dashjs@4.7.4/dist/dash.all.min.js`)}get ctor(){return i(this,F)}get instance(){return i(this,T).instance}get type(){return"dash"}get canLiveSync(){return!0}get config(){return i(this,T).config}set config(s){i(this,T).config=s}get library(){return i(this,S)}set library(s){o(this,S,s)}preconnect(){_(i(this,S))&&vt(i(this,S))}setup(){super.setup(),new Nt(i(this,S),this.ctx,s=>{o(this,F,s),i(this,T).setup(s),this.ctx.notify("provider-setup",this);let d=Et(this.ctx.$state.source);d&&this.loadSource(d)})}async loadSource(s,d){if(!_(s.src)){this.removeSource();return}this.media.preload=d||"",this.appendSource(s,"application/x-mpegurl"),i(this,T).loadSource(s),this.currentSrc=s}onInstance(s){let d=i(this,T).instance;return d&&s(d),i(this,T).onInstance(s)}destroy(){i(this,T).destroy()}},F=new WeakMap,T=new WeakMap,S=new WeakMap,R.supported=wt(),R);export{Vt as DASHProvider};
