import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,d as l,o as n}from"./app-BICfmULO.js";const e={};function t(h,i){return n(),a("div",null,i[0]||(i[0]=[l(`<div class="hint-container tip"><p class="hint-container-title">提示</p><p>在本例中，宿主机操作系统使用 CentOS 7.9.2009，容器服务使用 Docker 提供。</p></div><h2 id="_1-安装-docker-软件源" tabindex="-1"><a class="header-anchor" href="#_1-安装-docker-软件源"><span>1. 安装 Docker 软件源</span></a></h2><div class="hint-container tip"><p class="hint-container-title">提示</p><p>提供容器服务的软件包括 Docker、Podman 等，这里以 Docker 为例，进行安装和配置说明。</p></div><ol><li><p>更新所有软件包</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span></span></code></pre></div></li><li><p>安装需要的软件包， <code>yum-util</code> 提供 <code>yum-config-manager</code> 功能，<code>device-mapper-persistent-data</code> 和 <code>lvm2</code> 是 <code>devicemapper</code> 驱动所需的依赖。</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum-utils</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> device-mapper-persistent-data</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lvm2</span></span></code></pre></div></li><li><p>从 docker 官方下载并导入 docker-ce 的源</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yum-config-manager</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --add-repo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://download.docker.com/linux/centos/docker-ce.repo</span></span></code></pre></div><div class="hint-container note"><p class="hint-container-title">注</p><p>如果官方源访问不了或者很慢的话，也可以使用国内的 docker 源。</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yum-config-manager</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --add-repo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span></code></pre></div><p>不过，这里你如果用了国内的源的话，我建议你 <code>CentOS-Base.repo</code> 那里也换成相同的国内源。</p></div></li></ol><h2 id="_2-安装-docker-社区版" tabindex="-1"><a class="header-anchor" href="#_2-安装-docker-社区版"><span>2. 安装 Docker 社区版</span></a></h2><ol><li><p>安装 Docker 社区版</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker-ce</span></span></code></pre></div></li><li><p>配置 docker 加速域名。<br> 编辑 <code>/etc/docker/daemon.json</code> 文件。（如果没有就直接创建）</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="/etc/docker/daemon.json"><span>/etc/docker/daemon.json</span></div><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;registry-mirrors&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    &quot;https://proxy.1panel.live&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    &quot;https://docker.1panel.top&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    &quot;https://docker.m.daocloud.io&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    &quot;https://docker.1ms.run&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    &quot;https://docker.k</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;" class="highlighted-word">etc</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">hes.cn&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  ]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></li><li><p>重启加载 daemon，重启 docker 服务。</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> daemon-reload</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span></span></code></pre></div></li><li><p>拉取 ubuntu 镜像，这里我拉取的是 ubuntu 24.04 LTS 版本，产品代号是 noble 。</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> search</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ubuntu</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ubuntu:noble-20250415.1</span></span></code></pre></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>其实 docker hub 里也有做好的带 GUI 桌面的 ubuntu 镜像可以直接下载。如果不想折腾可以直接下载人家做好的。</p><p>例如：KasmWeb，可以直接在 docker hub 中搜索他们的仓库，也可以访问他们的<a href="https://registry.kasmweb.com/1.0/" target="_blank" rel="noopener noreferrer">官方网站</a>查看。</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> search</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kasmweb/ubuntu</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kasmweb/ubuntu-noble-desktop:x86_64-1.17.0</span></span></code></pre></div></div></li></ol><h2 id="_3-运行-ubuntu-容器-并安装-xfce-桌面环境" tabindex="-1"><a class="header-anchor" href="#_3-运行-ubuntu-容器-并安装-xfce-桌面环境"><span>3. 运行 ubuntu 容器，并安装 xfce 桌面环境</span></a></h2><ol><li><p>运行 ubuntu 容器</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -itd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ubuntu-2404-xfce-x86_64</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --shm-size=512m</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 3522:22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ubuntu:noble-20250415.1</span></span></code></pre></div><div class="hint-container note"><p class="hint-container-title">参数说明</p><ul><li><code>-i</code>：以交互模式运行容器，通常与 <code>-t</code> 同时使用。</li><li><code>-t</code>：为容器重新分配一个为输入终端，通常与 <code>-i</code> 同时使用。</li><li><code>-d</code>：后台运行容器，返回容器 ID。</li><li><code>--name</code>：为容器指定一个名称。</li><li><code>--shm-size</code>：配置共享内存，默认情况下，Docker 容器的共享内存大小为 64MB，对于带有 GUI 桌面的 ubuntu 可能不够用，如果需要在 容器中运行较为消耗内存的软件的话，这个值需要设置的相对大一些。</li><li><code>-p 宿主机端口:容器端口</code>：端口映射，将容器的端口映射到宿主机的端口中。</li></ul></div></li><li><p>查看容器运行状态。</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ps</span></span></code></pre></div></li></ol><h3 id="_3-1-安装工具和软件" tabindex="-1"><a class="header-anchor" href="#_3-1-安装工具和软件"><span>3.1 安装工具和软件</span></a></h3><ol><li><p>进入容器控制台。</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -it</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> f5b1a4eadf47</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /bin/bash</span></span></code></pre></div></li><li><p>更新软件</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span></span></code></pre></div></li><li><p>安装必要的工具和软件</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> vim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> curl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tcpdump</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> net-tools</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> xrdp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> openssh-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unzip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bzip2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> namp</span></span></code></pre></div></li><li><p>安装 xfce4</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> xfce4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> xfce4-goodies</span></span></code></pre></div><div class="hint-container note"><p class="hint-container-title">注</p><p>我也尝试过 gnome 和 kde，要么是没做成功，要么是必须给特权权限，目前就只有 xfce 做出来了。</p></div></li></ol><h3 id="_3-2-创建用户" tabindex="-1"><a class="header-anchor" href="#_3-2-创建用户"><span>3.2 创建用户</span></a></h3><ol><li><p>创建 user 用户，配置密码，并赋予 <code>sudo</code> 权限。</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">useradd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /home/user/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /bin/bash</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">usermod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -aG</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">passwd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user</span></span></code></pre></div></li></ol><h3 id="_3-3-配置远程桌面服务" tabindex="-1"><a class="header-anchor" href="#_3-3-配置远程桌面服务"><span>3.3 配置远程桌面服务</span></a></h3><ol><li><p>编辑 xrdp 配置文件 <code>/etc/xrdp/startwm.sh</code>。</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="/etc/xrdp/startwm.sh"><span>/etc/xrdp/startwm.sh</span></div><div class="language-bash line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="bash" style="--vp-collapsed-lines:15;--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/sh</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># xrdp X session start script (c) 2015, 2017, 2021 mirabilos</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># published under The MirOS Licence</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Rely on /</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;" class="highlighted-word">etc</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/pam.d/xrdp-sesman using pam_env to load both</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># /</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;" class="highlighted-word">etc</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/environment and /</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;" class="highlighted-word">etc</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/default/locale to initialise the</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># locale and the user environment properly.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 添加以下两行</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">unset</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DBUS_SESSION_BUS_ADDRESS</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">unset</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> XDG_RUNTIME_DIR</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> test</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;" class="highlighted-word">etc</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        .</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;" class="highlighted-word">etc</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/profile</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> test</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ~/.profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        .</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ~/.profile</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 注释以下两行</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#test -x /</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;" class="highlighted-word">etc</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/X11/Xsession &amp;&amp; exec /</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;" class="highlighted-word">etc</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/X11/Xsession</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#exec /bin/sh /</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;" class="highlighted-word">etc</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/X11/Xsession</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 添加以下内容</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">startxfce4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div></div></li><li><p>调整 xrdp 配置文件 <code>/etc/xrdp/xrdp.ini</code>，来优化远程桌面质量。</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="/etc/xrdp/xrdp.ini"><span>/etc/xrdp/xrdp.ini</span></div><div class="language-ini line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="ini" style="--vp-collapsed-lines:15;--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">……</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启用数据压缩，从而减少需要通过网络传输的数据量。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 位图压缩？</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">bitmap_compression</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">true</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 批量压缩</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">bulk_compression</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">true</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">……</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 每个像素最大位数，32/24/16/8</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#max_bpp=32</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">max_bpp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">128</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">……</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 这会禁用加密，加密可以通过减少服务器上的CPU使用率来提高性能。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 但是，只有在通过安全网络连接时才能这样做。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#crypt_level=high</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">crypt_level</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">none</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">……</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>这个配置可改可不改，改了似乎可以优化远程桌面的图像质量，不改也可以正常访问远程桌面，这里我建议，如果远程桌面质量没啥问题的话就不要改了。</p></div></li><li><p>调整 xrdp 配置文件 <code>/etc/xrdp/sesman.ini</code>，来优化远程桌面性能。</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="/etc/xrdp/sesman.ini"><span>/etc/xrdp/sesman.ini</span></div><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">……</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 杀掉断开的会话</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#KillDisconnected=false</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">KillDisconnected</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">true</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">……</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 断开会话的超时时间</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置为 0 可以立即终止断开的会话</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">DisconnectedTimeLimit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">……</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>这个配置可改可不改，改了似乎可以提升远程桌面的性能，不改也可以正常访问远程桌面，这里我建议，如果远程桌面用起来没啥问题的话就不要改了，后面碰到问题再改不迟。</p></div></li><li><p>设置系统在启动 x 会话时使用 xfce4 作为默认的会话管理器。</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">su</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">xfce4-session</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">~/.xsession</span></span></code></pre></div></li></ol><h3 id="_3-4-设置中文语言环境和中文输入法" tabindex="-1"><a class="header-anchor" href="#_3-4-设置中文语言环境和中文输入法"><span>3.4 设置中文语言环境和中文输入法</span></a></h3><ol><li><p>安装中文语言包</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> locales</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> xfonts-intl-chinese</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fonts-wqy-microhei</span></span></code></pre></div></li><li><p>语言环境设置</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dpkg-reconfigure</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> locales</span></span></code></pre></div></li><li><p>安装中文输入法</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fcitx5</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fcitx5-chinese-addons</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fcitx5-frontend-gtk4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fcitx5-frontend-gtk3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fcitx5-frontend-gtk2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fcitx5-frontend-qt5</span></span></code></pre></div></li><li><p>设置 Fcitx 5 所需的环境变量</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="/etc/profile"><span>/etc/profile</span></div><div class="language-ssh-config line-numbers-mode" data-highlighter="shiki" data-ext="ssh-config" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro has-diff vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 在文件的末尾添加</span></span>
<span class="line diff add"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">export </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">GTK_IM_MODULE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=fcitx </span></span>
<span class="line diff add"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">export </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">QT_IM_MODULE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=fcitx </span></span>
<span class="line diff add"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">export </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">XMODIFIERS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=@im=fcitx </span></span>
<span class="line diff add"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">export </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">INPUT_METHOD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=fcitx </span></span>
<span class="line diff add"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">export </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">SDL_IM_MODULE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=fcitx </span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="hint-container note"><p class="hint-container-title">注</p><p>添加到 <code>/etc/profile</code> 、<code>~/.profile</code> 里面的效果是一样的，<code>~/.profile</code> 是针对当前用户生效，<code>/etc/profile</code> 是针对所有用户生效。</p></div></li><li><p>配置 Fcitx 5 开机自动启动</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ~/.config/autostart</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/share/applications/org.fcitx.Fcitx5.desktop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ~/.config/autostart</span></span></code></pre></div></li></ol><h3 id="_3-5-安装软件" tabindex="-1"><a class="header-anchor" href="#_3-5-安装软件"><span>3.5 安装软件</span></a></h3><p>略</p><h2 id="_4-使用-dockerfile-方式配置容器运行后自动执行脚本" tabindex="-1"><a class="header-anchor" href="#_4-使用-dockerfile-方式配置容器运行后自动执行脚本"><span>4. 使用 Dockerfile 方式配置容器运行后自动执行脚本</span></a></h2><p>通过 Dockerfile，可以自动化地构建 Docker 镜像，简化应用的部署和管理。</p><p>我们这里仅通过编写 Dockerfile，构建镜像，并确保容器启动时自动启动服务。</p><div class="hint-container note"><p class="hint-container-title">Dockerfile 的基本结构</p><p>Dockerfile 是一个文本文件，包含了一系列用于构建镜像的指令。每条指令都会构建一层镜像，指令的内容描述了该层镜像应如何构建。</p><p>Dockerfile的基本结构如下：</p><ul><li><strong>注释行</strong>：以 <code>#</code> 开头，用于说明和注释。</li><li><strong>指令行</strong>：以专用指令开头，如 <code>FROM</code>、<code>RUN</code> 等。</li></ul><p>Dockerfile的常用指令</p><ul><li><strong>FROM</strong>：初始化一个新的构建阶段，并设置基础镜像。</li><li><strong>MAINTAINER</strong>：指定作者信息（注意：新版Docker中推荐使用LABEL来替代）。</li><li><strong>RUN</strong>：在当前镜像层上执行命令。</li><li><strong>COPY</strong>：将文件或目录复制到镜像中。</li><li><strong>ADD</strong>：类似于COPY，但支持从URL下载文件。</li><li><strong>EXPOSE</strong>：声明容器在运行时监听的端口。</li><li><strong>CMD</strong>：指定容器启动时要执行的命令。</li><li><strong>ENTRYPOINT</strong>：配置容器启动时的入口点。</li></ul></div><ol><li><p>在容器的宿主机中创建一个文件夹，用来存放 Dockerfile 相关的文件。</p><p>以我这个为例，在宿主机的 <code>/root/</code> 目录下创建了一个 <code>dockerfile_dir</code> 文件夹，用来存放各种 Dockerfile 文件，之所以取 <code>dockerfile_dir</code> 名字是因为要存储的 Dockerfile 的文件名必须是「Dockerfile」，所以文件夹我就换了个名字以示区别。 <code>ubuntu-2404-xfce</code> 是我准备制作的这个容器的名字。</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/dockerfile_dir/ubuntu-2404-xfce</span></span></code></pre></div></li><li><p>接下来，进入到 <code>/root/dockerfile_dir/ubuntu-2404-xfce</code> 目录中。在目录中首先创建一个 <code>Dockerfile</code> 文件，在其中写入以下内容。</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="/root/dockerfile_dir/ubuntu-2404-xfce/Dockerfile"><span>/root/dockerfile_dir/ubuntu-2404-xfce/Dockerfile</span></div><div class="language-dockerfile line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="dockerfile" style="--vp-collapsed-lines:15;--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 这个 Dockerfile 要对哪一个镜像（image）生效</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;" class="highlighted-word">ubuntu-2404-xfce</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-x86_64:v1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置作者信息</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">LABEL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> maintainer=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;username@example.com&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 复制启动脚本到容器中</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Dockerfile 还有很多很强大的用途，甚至上面所有的步骤都可以用 Dockerfile 来完成</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 这里我只用来写入一个自动启动脚本</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将 start_service.sh 放到容器的 /</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;" class="highlighted-word">root</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/ 目录下</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ADD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> start_service.sh /</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;" class="highlighted-word">root</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/start_service.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置脚本权限</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> chmod 777 /</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;" class="highlighted-word">root</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/start_service.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置容器需要暴露的端口</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">EXPOSE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 22 3389</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置容器启动命令</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置好后，容器启动后就会执行 bash /</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;" class="highlighted-word">root</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/start_service.sh 这个命令</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;bash&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;" class="highlighted-word">root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/start_service.sh&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div></div></li><li><p>接下来，我们需要在 Dockerfile 的同一目录下，将我们需要上传到容器中的启动脚本也写出来。</p><p>默认情况下，服务的开机启动都是使用 <code>systemctl enable &lt;服务名&gt;</code> 但在容器中 <code>systemctl</code> 不能用，只能通过脚本的方式来完成。</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="/root/dockerfile_dir/ubuntu-2404-xfce/start_service.sh"><span>/root/dockerfile_dir/ubuntu-2404-xfce/start_service.sh</span></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置一个记录日志的时间</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOGTIME</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/usr/bin/date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;+%Y-%m-%d %H:%M:%S&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将日志输出到 /var/log/start_service.log 中</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/usr/bin/echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$LOGTIME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">] startup run...&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/var/log/start_service.log</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启动 sshd 服务</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/usr/sbin/service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ssh</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/var/log/start_service.log</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启动 xrdp 服务</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/usr/sbin/service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> xrdp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/var/log/start_service.log</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 睡眠，目的是为了保持容器在前台运行不退出</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> infinity</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><ol><li>容器运行必须有一个前台进程， 如果没有前台进程执行，容器认为空闲，就会自行退出。</li><li>容器运行的命令如果不是那些一直挂起的命令（ 运行top，tail、循环等），就是会自动退出。</li><li>这个是容器的机制问题。</li></ol><p>在上面这个脚本中，因为 Dockerfile 设置了容器启动后，自动执行 <code>bash /root/start_service.sh</code> 脚本，所以如果这个脚本执行完毕退出了，容器会跟着退出，所以我们需要让这个脚本一直跑下去，不能退出，所以才会在脚本最后添加一个 <code>sleep infinity</code> 让脚本虽然已经执行完毕了，还要挂在前台。</p></div></li><li><p>将我们完成配置的容器生成镜像（image）</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> f5b1a4eadf47</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> commit</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> f5b1a4eadf47</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ubuntu-2404-xfce-x86_64:v1</span></span></code></pre></div><div class="hint-container note"><p class="hint-container-title">参数说明</p><ul><li>f5b1a4eadf47： 是要转为镜像的那个容器的 ID</li><li>ubuntu-2404-xfce-x86_64:v1：是镜像的名称和 tag，这个名称和 tag 要和前面 Dockerfile 中 <code>FROM</code> 字段中的内容保持一致。</li></ul></div></li><li><p>进入存有 Dockerfile 的文件夹中，执行下面的命令构建新的镜像。</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/dockerfile_dir/ubuntu-2404-xfce/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ubuntu-2404-xfce-x86_64:v1.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .</span></span></code></pre></div></li><li><p>构建出来的 <code>ubuntu-2404-xfce-x86_64:v1.1</code> 镜像就是可以分发使用了。</p></li></ol>`,23)]))}const d=s(e,[["render",t]]),r=JSON.parse('{"path":"/posts/Config/Docker/Config/2025-05-07-%E5%88%B6%E4%BD%9C%E5%B8%A6%E6%9C%89xfce%E6%A1%8C%E9%9D%A2%E7%9A%84ubuntu%E5%AE%B9%E5%99%A8.html","title":"制作带有 xfce 桌面的 ubuntu 容器","lang":"zh-CN","frontmatter":{"title":"制作带有 xfce 桌面的 ubuntu 容器","shortTitle":"制作带有 xfce 桌面的 ubuntu 容器","description":"制作带有 xfce 桌面的 ubuntu 容器","icon":"/assets/blogicons/Docker.png","author":null,"isOriginal":true,"date":"2025-05-07T00:00:00.000Z","categories":["Docker"],"tags":["Docker","ubuntu","xfce"],"license":"MIT","sticky":false,"star":true,"article":true,"timeline":true,"comment":false,"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"制作带有 xfce 桌面的 ubuntu 容器\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-05-07T00:00:00.000Z\\",\\"dateModified\\":\\"2025-06-09T11:46:07.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"昌霖学长\\",\\"email\\":\\"shawnlyu1990@gmail.com\\"}]}"],["meta",{"property":"og:url","content":"https://shawnlyu1990.github.io/posts/Config/Docker/Config/2025-05-07-%E5%88%B6%E4%BD%9C%E5%B8%A6%E6%9C%89xfce%E6%A1%8C%E9%9D%A2%E7%9A%84ubuntu%E5%AE%B9%E5%99%A8.html"}],["meta",{"property":"og:site_name","content":"昌霖学长的自习室"}],["meta",{"property":"og:title","content":"制作带有 xfce 桌面的 ubuntu 容器"}],["meta",{"property":"og:description","content":"制作带有 xfce 桌面的 ubuntu 容器"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-06-09T11:46:07.000Z"}],["meta",{"property":"article:tag","content":"xfce"}],["meta",{"property":"article:tag","content":"ubuntu"}],["meta",{"property":"article:tag","content":"Docker"}],["meta",{"property":"article:published_time","content":"2025-05-07T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-06-09T11:46:07.000Z"}]]},"git":{"createdTime":1747728716000,"updatedTime":1749469567000,"contributors":[{"name":"Shawn Lyu","username":"","email":"shawnlyu1990@gmail.com","commits":2}]},"readingTime":{"minutes":9.23,"words":2769},"filePathRelative":"posts/Config/Docker/Config/2025-05-07-制作带有xfce桌面的ubuntu容器.md","excerpt":"","copyright":{"license":"MIT"}}');export{d as comp,r as data};
